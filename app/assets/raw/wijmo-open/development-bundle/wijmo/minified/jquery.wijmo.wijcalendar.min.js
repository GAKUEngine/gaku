/*
 *
 * Wijmo Library 2.0.0
 * http://wijmo.com/
 *
 * Copyright(c) ComponentOne, LLC.  All rights reserved.
 * 
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * licensing@wijmo.com
 * http://www.wijmo.com/license
 *
 **/
(function(a){"use strict";var c={general:0,weekEnd:1,otherMonth:2,outOfRange:4,today:8,custom:16,disabled:32,selected:64,gap:128};a.widget("wijmo.wijcalendar",{options:{culture:"",monthCols:1,monthRows:1,titleFormat:"MMMM yyyy",showTitle:true,displayDate:undefined,dayRows:6,dayCols:7,weekDayFormat:"short",showWeekDays:true,showWeekNumbers:false,calendarWeekRule:"firstDay",minDate:new Date(1900,0,1),maxDate:new Date(2099,11,31),showOtherMonthDays:true,showDayPadding:false,selectionMode:{day:true,days:true},allowPreview:false,allowQuickPick:true,toolTipFormat:"dddd, MMMM dd, yyyy",prevTooltip:"Previous",nextTooltip:"Next",quickPrevTooltip:"Quick Previous",quickNextTooltip:"Quick Next",prevPreviewTooltip:"",nextPreviewTooltip:"",navButtons:"default",quickNavStep:12,direction:"horizontal",duration:250,easing:"easeInQuad",popupMode:false,autoHide:true,customizeDate:null,title:null,beforeSlide:null,afterSlide:null,beforeSelect:null,afterSelect:null,selectedDatesChanged:null},_create:function(){this.element.addClass("wijmo-wijcalendar ui-datepicker-inline ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all").attr("role","grid");this._previewWrapper(this.options.allowPreview);this.element.data("preview.wijcalendar",false)},_init:function(){if(this.options.popupMode){var a={autoHide:!!this.options.autoHide};if(this.options.beforePopup)a.showing=this.options.beforePopup;if(this.options.afterPopup)a.shown=this.options.afterPopup;if(this.options.beforeClose)a.hiding=this.options.beforeClose;var b=this;a.hidden=function(a){b.element.removeData("lastdate.wijcalendar");b.options.afterClose&&b.options.afterClose.call(a)};this.element.wijpopup(a)}this._getSelectedDates();this._getDisabledDates();this._resetWidth();this.refresh();this.element.width(this.element.width()+2)},destroy:function(){a.Widget.prototype.destroy.apply(this,arguments);this.close();this.element.html("");this.element.removeClass("wijmo-wijcalendar ui-datepicker-inline ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all ui-datepicker-multi").removeAttr("role");var b=this;a.each(["preview","disableddates","selecteddates","dragging","lastdate","animating"],function(c,a){b.element.removeData(a+".wijcalendar")});this._previewWrapper(false)},_setOption:function(c,b){a.Widget.prototype._setOption.apply(this,arguments);var d=this;switch(c){case"showWeekDays":case"showWeekNumbers":case"showTitle":case"showOtherMonthDays":case"selectionMode":this.unSelectAll();this._resetWidth();this.refresh();break;case"culture":this.refresh();break;case"allowPreview":this._previewWrapper(b);this.refresh();break;case"monthCols":this._resetWidth();this.refresh();break;case"autoHide":this.element.wijpopup({autoHide:this.options.autoHide});break;case"selectedDates":this._getSelectedDates().setDates(b);this.refresh();break;case"disabledDates":this._getDisabledDates().setDates(b);this.refresh()}},_previewWrapper:function(a){if(a)!this.element.parent().hasClass("wijmo-wijcalendar-preview-wrapper")&&this.element.wrap("<div class='wijmo-wijcalendar-preview-wrapper ui-helper-clearfix'></div>");else this.element.parent().hasClass("wijmo-wijcalendar-preview-wrapper")&&this.element.unwrap()},_isRTL:function(){return!!this._getCulture().isRTL},refresh:function(){this.element.empty().append(this._createCalendar());this.element[(this._isRTL()?"add":"remove")+"Class"]("ui-datepicker-rtl");this._bindEvents()},refreshDate:function(b){if(!this._monthViews)return;if(b<this._groupStartDate||b>this._groupEndDate)return;a.each(this._monthViews,function(){this._refreshDate(b)})},getDisplayDate:function(){var a=this.options.displayDate?this.options.displayDate:new Date;if(b.isSameDate(a,new Date(1900,0,1)))a=new Date;return a},getSelectedDate:function(){var a=this.options.selectedDates;return!a||a.length===0?null:a[0]},selectDate:function(a){a=new Date(a);if(this._getDisabledDates().contains(a))return false;if(a<this.options.minDate||a>this.options.maxDate)return false;this._getSelectedDates().add(a);this.refreshDate(a);return true},unSelectDate:function(a){a=new Date(a);if(this._getDisabledDates().contains(a))return false;if(a<this.options.minDate||a>this.options.maxDate)return false;this._getSelectedDates().remove(a);this.refreshDate(a);return true},unSelectAll:function(){var a=this.options.selectedDates,b;if(a&&a.length>0){this._getSelectedDates().clear();for(b=0;b<a.length;b++)this.refreshDate(a[b])}},_slideToDate:function(a){if(b.isSameMonth(this.getDisplayDate(),a))return;var c=this.element.is(":visible");if(!c)this.options.displayDate=a;else{if(this._trigger("beforeSlide")===false)return;if(this._isSingleMonth())this._playSlideAnimation(a);else this._playMmSlideAnimation(a)}},isPopupShowing:function(){return!!this.options.popupMode?this.element.wijpopup("isVisible"):false},popup:function(a){this._myGrid=undefined;this.refresh();this.element.data("dragging.wijcalendar",false);this.element.wijpopup("show",a)},popupAt:function(a,b){this._myGrid=undefined;this.refresh();this.element.data("dragging.wijcalendar",false);this.element.wijpopup("showAt",a,b)},close:function(){this.isPopupShowing()&&this.element.wijpopup("hide")},_getCulture:function(a){return Globalize.findClosestCulture(a||this.options.culture)},_getDates:function(b){var c=b.toLowerCase()+".wijcalendar",a=this.element.data(c);if(a===undefined){a=new f(this,b);this.element.data(c,a)}return a},_getDisabledDates:function(){return this._getDates("disabledDates")},_getSelectedDates:function(){return this._getDates("selectedDates")},_onDayDragStart:function(a){a.preventDefault();a.stopPropagation();return false},_onDayMouseDown:function(b){b.preventDefault();b.stopPropagation();var d=this.options,g=this;if(b.which!==1)return false;var c=this._getCellDate(b.currentTarget);if(c===undefined)return false;if(!d.selectionMode.day)return false;var f={date:c};if(this._trigger("beforeSelect",null,f)===false)return false;(!d.selectionMode.days||!b.metaKey&&!b.shiftKey)&&this.unSelectAll();var e=true;if(!!d.selectionMode.days&&b.shiftKey&&this.element.data("lastdate.wijcalendar"))this._selectRange(this.element.data("lastdate.wijcalendar"),c);else{this.element.data("lastdate.wijcalendar",c);e=this.selectDate(c);this._trigger("selectedDatesChanged",null,{dates:[c]})}if(e){this._trigger("afterSelect",null,f);if(!!d.selectionMode.days){this.element.data("dragging.wijcalendar",true);a(document.body).bind("mouseup."+this.widgetName,function(){a(document.body).unbind("mouseup."+g.widgetName);g.element.data("dragging.wijcalendar",false)})}}return false},_onDayClicked:function(c){var b=this._getCellDate(c.currentTarget);if(b===undefined)return false;if(!this.options.selectionMode.day)return false;if(this.isPopupShowing())this.close();else a(c.currentTarget).hasClass("ui-datepicker-other-month")&&this._slideToDate(b);return false},_onDayMouseEnter:function(b){a(b.currentTarget).attr("state","hover");this._refreshDayCell(b.currentTarget);if(!!this.element.data("dragging.wijcalendar")){var c=this._getCellDate(b.currentTarget);if(c===undefined)return;this.unSelectAll();this._selectRange(this.element.data("lastdate.wijcalendar"),c,true)}},_onDayMouseLeave:function(b){a(b.currentTarget).attr("state","normal");this._refreshDayCell(b.currentTarget)},_selectRange:function(a,e,g){if(a!==undefined&&a!==new Date(1900,1,1)){var c=a,f=e;if(a>e){f=a;c=e}for(var d=[];;){if(c>f)break;this.selectDate(c);d[d.length]=c;c=b.addDays(c,1)}!g&&this.element.removeData("lastdate.wijcalendar");this._trigger("selectedDatesChanged",null,{dates:d})}else{this.selectDate(a);this._trigger("selectedDatesChanged",null,{dates:[a]})}return true},_getCellDate:function(c){var b=a(c).attr("date");return b===undefined?b:new Date(b)},_getParentTable:function(c){var b=a(c).parents("table");return b.length===0?undefined:b.get(0)},_initMonthSelector:function(e){if(a(e).data("cells")!==undefined)return;var d=e.id.split("_");if(d[d.length-1]!=="ms")throw Error.create("not a monthview");var k=d.slice(0,d.length-1).join("_"),c=this._getParentTable(e),h=[],f,g,b,i;if(c){if(c.id!==k)throw Error.create("not a monthview");for(f=0;f<c.rows.length;f++){var j=c.rows[f];for(g=0;g<j.cells.length;g++){b=j.cells[g];if(b){i=a(b).attr("daytype");if(i!==undefined)if(a(b).find("a").hasClass("ui-priority-secondary")===false)if(this._isSelectable(parseInt(i,10)))h[h.length]=b}}}}a(e).data("cells",h)},_onMonthSelectorClicked:function(g){this._initMonthSelector(g.currentTarget);var d=a(g.currentTarget).data("cells"),b;this.element.removeData("lastdate.wijcalendar");this.unSelectAll();var c=[];for(b=0;b<d.length;b++){var h=d[b],f=a(h).attr("date");if(f!==undefined){var e=new Date(f);this.selectDate(e);c[c.length]=e}}this._trigger("selectedDatesChanged",null,{dates:c});this.isPopupShowing()&&this.close();return false},_onMonthSelectorMouseEnter:function(b){this._initMonthSelector(b.currentTarget);for(var d=a(b.currentTarget).data("cells"),c=0;c<d.length;c++){b.currentTarget=d[c];this._onDayMouseEnter(b)}},_onMonthSelectorMouseLeave:function(b){this._initMonthSelector(b.currentTarget);for(var d=a(b.currentTarget).data("cells"),c=0;c<d.length;c++){b.currentTarget=d[c];this._onDayMouseLeave(b)}},_initWeekDaySelector:function(f){if(a(f).data("cells")!==undefined)return;var b=f.id.split("_");if(b[b.length-2]!=="cs")throw Error.create("not a column");var h=parseInt(b[b.length-1],10),k=b.slice(0,b.length-2).join("_"),d=this._getParentTable(f),g=[];if(d){if(d.id!==k)throw Error.create("not a column");var c=0;if(!this._isSingleMonth())c++;if(this.options.showWeekDays)c++;for(;c<d.rows.length;c++){var j=d.rows[c];if(h<j.cells.length){var e=j.cells[h];if(e){var i=a(e).attr("daytype");if(i!==undefined)if(a(e).find("a").hasClass("ui-priority-secondary")===false)if(this._isSelectable(parseInt(i,10)))g[g.length]=e}}}}a(f).data("cells",g)},_onWeekDayClicked:function(g){this._initWeekDaySelector(g.currentTarget);var d=a(g.currentTarget).data("cells"),b;this.unSelectAll();var c=[];for(b=0;b<d.length;b++){var h=a(d[b]),f=h.attr("date");if(f!==undefined){var e=new Date(f);this.selectDate(e);c[c.length]=e}}this._trigger("selectedDatesChanged",null,{dates:c});this.isPopupShowing()&&this.close();return false},_onWeekDayMouseEnter:function(b){this._initWeekDaySelector(b.currentTarget);for(var d=a(b.currentTarget).data("cells"),c=0;c<d.length;c++){b.currentTarget=d[c];this._onDayMouseEnter(b)}},_onWeekDayMouseLeave:function(b){this._initWeekDaySelector(b.currentTarget);for(var d=a(b.currentTarget).data("cells"),c=0;c<d.length;c++){b.currentTarget=d[c];this._onDayMouseLeave(b)}},_initWeekNumberSelector:function(d){if(a(d).data("cells")!==undefined)return;var b=d.id.split("_");if(b[b.length-2]!=="rs")throw Error.create("not a row");var j=parseInt(b[b.length-1],10),k=b.slice(0,b.length-2).join("_"),f=this._getParentTable(d),g=[];if(f){if(f.id!==k)throw Error.create("not a row");var h=f.rows[j];if(h){var e=0;if(this.options.showWeekNumbers)e++;for(;e<h.cells.length;e++){var c=h.cells[e];if(c){var i=a(c).attr("daytype");if(i!==undefined)if(a(c).find("a").hasClass("ui-priority-secondary")===false)if(this._isSelectable(parseInt(i,10)))g[g.length]=c}}}}a(d).data("cells",g)},_onWeekNumberClicked:function(g){this._initWeekNumberSelector(g.currentTarget);var d=a(g.currentTarget).data("cells");this.unSelectAll();for(var b=[],c=0;c<d.length;c++){var h=a(d[c]),f=h.attr("date");if(f!==undefined){var e=new Date(f);this.selectDate(e);b[b.length]=e}}this._trigger("selectedDatesChanged",null,{dates:b});this.isPopupShowing()&&this.close();return false},_onWeekNumberMouseEnter:function(b){this._initWeekNumberSelector(b.currentTarget);for(var d=a(b.currentTarget).data("cells"),c=0;c<d.length;c++){b.currentTarget=d[c];this._onDayMouseEnter(b)}},_onWeekNumberMouseLeave:function(b){this._initWeekNumberSelector(b.currentTarget);for(var d=a(b.currentTarget).data("cells"),c=0;c<d.length;c++){b.currentTarget=d[c];this._onDayMouseLeave(b)}},_isAnimating:function(){return!!this.element.data("animating.wijcalendar")},_onPreviewMouseEnter:function(h){if(!!this.element.data("previewContainer"))return;if(this._isAnimating())return;var g=a(h.currentTarget),d=g.attr("id");if(d===undefined)return;var f=this.getDisplayDate(),e=this.options.monthCols*this.options.monthRows;if(d==="prevPreview")e=-e;this.options.displayDate=b.addMonths(f,e);this.element.data("preview.wijcalendar",true);var c=a("<div/>");c.appendTo(document.body);c.hide();c.addClass("wijmo-wijcalendar ui-datepicker-inline ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all");c.append(this._createCalendar());this.options.displayDate=f;this.element.data("preview.wijcalendar",false);this._createMonthViews();c.wijpopup({showEffect:"slide",showOptions:{direction:d==="prevPreview"?"right":"left"},hideEffect:"slide",hideOptions:{direction:d==="prevPreview"?"right":"left"}});c.wijpopup("show",{my:d==="prevPreview"?"right top":"left top",at:d==="prevPreview"?"left top":"right top",of:g});this.element.data("previewContainer",c)},_onPreviewMouseLeave:function(c){var f=a(c.currentTarget),d=f.attr("id");if(d===undefined)return;var b=this.element.data("previewContainer");if(b)if(b.wijpopup("isAnimating")){var e=this;window.setTimeout(function(){e._onPreviewMouseLeave(c)},200)}else{b.wijpopup("hide");this.element.removeData("previewContainer")}},_resetWidth:function(){if(!this._myGrid){this.element.css("height","");if(this.options.monthCols>1){this.element.css("width",17*this.options.monthCols+"em");this.element.addClass("ui-datepicker-multi")}else{this.element.css("width","");this.element.removeClass("ui-datepicker-multi")}}},_playMmSlideAnimation:function(f){var i=this.element.width(),g=this.element.height();this.element.height(g);var h=this.getDisplayDate();this.element.wrapInner("<div class='wijmo-wijcalendar-multi-aniwrapper'></div>");var d=this.element.find(">:first-child").width(i).height(g),a=d.clone(false);a.hide();this.options.displayDate=f;this._createMonthViews();a.empty().append(this._createMonthGroup());a.appendTo(this.element);var e=this.options.direction||"horizontal",c=f>h,b=this;this.element.data("animating.wijcalendar",true);d.effect("slide",{mode:"hide",direction:e==="horizontal"?c?"left":"right":c?"up":"down",easing:this.options.easing||"easeOutBack",duration:this.options.duration},function(){d.remove()});a.effect("slide",{direction:e==="horizontal"?c?"right":"left":c?"down":"up",easing:this.options.easing||"easeOutBack",duration:this.options.duration},function(){while(a.parent().is(".wijmo-wijcalendar-multi-aniwrapper"))a.parent().replaceWith(a);a.replaceWith(a.contents());b.element.height("");b._bindEvents();b.element.data("animating.wijcalendar",false);b._trigger("afterSlide")})},_playSlideAnimation:function(m){if(!this._isSingleMonth())return;var f=this,n=this.getDisplayDate(),c=this.element.find(".ui-datepicker-calendar"),b,k;if(c.parent().is(".wijmo-wijcalendar-aniwrapper"))b=c.parent();else{b=a.effects.createWrapper(c).css({overflow:"hidden"});b.removeClass("ui-effects-wrapper");b.addClass("wijmo-wijcalendar-aniwrapper")}if(b.parent().is(".wijmo-wijcalendar-aniwrapper"))k=b.parent();else{k=a.effects.createWrapper(b).css({overflow:"hidden"});k.removeClass("ui-effects-wrapper");k.addClass("wijmo-wijcalendar-aniwrapper")}var l=1;if(this._myGrid)switch(this._myGrid.gridType){case"month":l=1;break;case"year":l=10;break;case"decade":l=100}var i=this.options.direction||"horizontal",g=m>n,d=[];d[d.length]=m;var h=c.outerWidth(),j=c.outerHeight();if(i==="horizontal"){c.width(h).css("float",g?"left":"right");b.width((d.length+1)*h);b.css("left",g?0:-d.length*h).css("position","absolute")}else{b.width(h);b.css("top",g?0:-d.length*j).css("position","absolute");b.height((d.length+1)*j)}a.each(d,function(l,c){if(f._myGrid===undefined){var k=new e(f,c),d=f._customize(k.getHtml(true));if(i==="horizontal")d.width(h).css("float",g?"left":"right").appendTo(b);else d.appendTo(b)}else if(i==="horizontal")a(f._myGrid.getHtml(c,true)).width(h).height(j).css("float",g?"left":"right").appendTo(b);else a(f._myGrid.getHtml(c,true)).height(j).appendTo(b)});this.options.displayDate=m;this._myGrid===undefined&&this._createMonthViews();this._refreshTitle();this.element.data("animating.wijcalendar",true);b.effect("slide",{mode:"hide",direction:i==="horizontal"?g?"left":"right":g?"up":"down",easing:this.options.easing||"easeOutBack",distance:(i==="horizontal"?h:j)*d.length,duration:this.options.duration},function(){c=b.children(":last");while(c.parent().is(".wijmo-wijcalendar-aniwrapper"))c.parent().replaceWith(c);c.css({"float":"",width:""});f._bindEvents();f.element.data("animating.wijcalendar",false);f._trigger("afterSlide")})},_onTitleClicked:function(){if(!this.options.allowQuickPick||!this._isSingleMonth())return;if(this._isAnimating())return;if(this._myGrid===undefined)this._myGrid=new g(this);else switch(this._myGrid.gridType){case"month":this._myGrid.gridType="year";break;case"year":this._myGrid.gridType="decade";break;case"decade":return}this._refreshTitle();this.element.width(this.element.width()).height(this.element.height());var c=this.element.find(".ui-datepicker-calendar"),b,e,m=c.outerWidth(),f=c.outerHeight();if(c.parent().is(".wijmo-wijcalendar-aniwrapper"))b=c.parent();else b=a.effects.createWrapper(c).css({overflow:"hidden"}).removeClass("ui-effects-wrapper").addClass("wijmo-wijcalendar-aniwrapper");if(b.parent().is(".wijmo-wijcalendar-aniwrapper"))e=b.parent();else e=a.effects.createWrapper(b).css({overflow:"hidden"}).removeClass("ui-effects-wrapper").addClass("wijmo-wijcalendar-aniwrapper").width(m).height(f);var d=a(this._myGrid.getHtml(true)).css({position:"absolute",top:0,left:0,opacity:0}).appendTo(e).height(f),i=this._myGrid.getSelectedIndex(),l=Math.floor(i/4),o=i-l*4,k=m/4,j=f/3,n={left:k*o,top:j*l,width:k,height:j};c.width("100%").height("100%");b.css({border:"solid 1px #cccccc"});this.element.data("animating.wijcalendar",true);var h=this;b.effect("size",{to:n,duration:this.options.duration||500},function(){b.remove()});d.animate({opacity:1},this.options.duration||500,function(){d.css({position:"",top:"",left:"",filter:""});while(d.parent().is(".wijmo-wijcalendar-aniwrapper"))d.parent().replaceWith(d);h._bindEvents();h.element.data("animating.wijcalendar",false)})},_onMyGridClicked:function(p){if(this._myGrid===undefined)return false;if(this._isAnimating())return false;var c=a(p.currentTarget),h=parseInt(c.attr("index"),10),m=parseInt(c.attr("value"),10);if(this._myGrid.gridType!=="month")if(!h||h===11)return false;!c.hasClass("ui-state-active")&&this._myGrid.select(h,m);if(this._myGrid.gridType==="decade")this._myGrid.gridType="year";else if(this._myGrid.gridType==="year")this._myGrid.gridType="month";else this._myGrid=undefined;this._refreshTitle();var b=this.element.find(".ui-datepicker-calendar"),j,f,k=b.outerWidth(),i=b.outerHeight();if(b.parent().is(".wijmo-wijcalendar-aniwrapper"))f=b.parent();else f=a.effects.createWrapper(b).css({overflow:"hidden"}).removeClass("ui-effects-wrapper").addClass("wijmo-wijcalendar-aniwrapper").width(k).height(i);var l=a.extend({},c.position(),{width:c.width(),height:c.height()}),g;if(this._myGrid===undefined){this._createMonthViews();var n=this.getDisplayDate(),o=this._getMonthView(n);g=this._customize(o.getHtml(true))}else g=a(this._myGrid.getHtml(true));var d=g.height(i).appendTo(f);j=a.effects.createWrapper(d).css({overflow:"hidden"}).removeClass("ui-effects-wrapper").addClass("wijmo-wijcalendar-aniwrapper").css(a.extend(l,{border:"solid 1px #cccccc",position:"absolute"}));var e=this;this.element.data("animating.wijcalendar",true);j.animate({left:0,top:0,width:k,height:i},this.options.duration||500,function(){});b.animate({opacity:0},this.options.duration||500,function(){b.remove();while(d.parent().is(".wijmo-wijcalendar-aniwrapper"))d.parent().replaceWith(d);e._myGrid===undefined&&e.element.width("").height("");e._bindEvents();e.element.data("animating.wijcalendar",false)});return false},_onMyGridMouseEnter:function(d){if(this._myGrid===undefined)return;var c=a(d.currentTarget),b=parseInt(c.attr("index"),10);if(this._myGrid.gridType!=="month"&&(b<0||b>11))return;c.addClass("ui-state-hover")},_onMyGridMouseLeave:function(d){if(this._myGrid===undefined)return;var c=a(d.currentTarget),b=parseInt(c.attr("index"),10);if(this._myGrid.gridType!=="month"&&(b<0||b>11))return;c.removeClass("ui-state-hover")},_bindEvents:function(){if(!this.element.data("preview.wijcalendar")&&!this.options.disabled){this.element.find("div .wijmo-wijcalendar-navbutton").unbind().bind("mouseout.wijcalendar",function(){var b=a(this);b.removeClass("ui-state-hover");if(b.hasClass("ui-datepicker-next-hover"))b.removeClass("ui-datepicker-next-hover");else b.hasClass("ui-datepicker-prev-hover")&&b.removeClass("ui-datepicker-prev-hover")}).bind("mouseover.wijcalendar",function(){var b=a(this);b.addClass("ui-state-hover");if(b.hasClass("ui-datepicker-next"))b.addClass("ui-datepicker-next-hover");else b.hasClass("ui-datepicker-prev")&&b.addClass("ui-datepicker-prev-hover")}).bind("click.wijcalendar",a.proxy(this._onNavButtonClicked,this));this.element.find(".ui-datepicker-title").unbind().bind("mouseout.wijcalendar",function(){a(this).removeClass("ui-state-hover")}).bind("mouseover.wijcalendar",function(){a(this).addClass("ui-state-hover")}).bind("click.wijcalendar",a.proxy(this._onTitleClicked,this));this.element.find(".wijmo-wijcalendar-prevpreview-button, .wijmo-wijcalendar-nextpreview-button").unbind("mouseenter.wijcalendar").unbind("mouseleave.wijcalendar").bind({"mouseenter.wijcalendar":a.proxy(this._onPreviewMouseEnter,this),"mouseleave.wijcalendar":a.proxy(this._onPreviewMouseLeave,this)});if(this._myGrid===undefined){this.element.find(".wijmo-wijcalendar-day-selectable").unbind().bind({"click.wijcalendar":a.proxy(this._onDayClicked,this),"mouseenter.wijcalendar":a.proxy(this._onDayMouseEnter,this),"mouseleave.wijcalendar":a.proxy(this._onDayMouseLeave,this),"mousedown.wijcalendar":a.proxy(this._onDayMouseDown,this),"dragstart.wijcalendar":a.proxy(this._onDayDragStart,this)});!!this.options.selectionMode.month&&this.element.find(".wijmo-wijcalendar-monthselector").unbind().bind({"click.wijcalendar":a.proxy(this._onMonthSelectorClicked,this),"mouseenter.wijcalendar":a.proxy(this._onMonthSelectorMouseEnter,this),"mouseleave.wijcalendar":a.proxy(this._onMonthSelectorMouseLeave,this)});!!this.options.selectionMode.weekDay&&this.element.find(".ui-datepicker-week-day").unbind().bind({"click.wijcalendar":a.proxy(this._onWeekDayClicked,this),"mouseenter.wijcalendar":a.proxy(this._onWeekDayMouseEnter,this),"mouseleave.wijcalendar":a.proxy(this._onWeekDayMouseLeave,this)});!!this.options.selectionMode.weekNumber&&this.element.find(".wijmo-wijcalendar-week-num").unbind().bind({"click.wijcalendar":a.proxy(this._onWeekNumberClicked,this),"mouseenter.wijcalendar":a.proxy(this._onWeekNumberMouseEnter,this),"mouseleave.wijcalendar":a.proxy(this._onWeekNumberMouseLeave,this)})}else this.element.find(".wijmo-wijcalendar-day-selectable").unbind().bind({"click.wijcalendar":a.proxy(this._onMyGridClicked,this),"mouseenter.wijcalendar":a.proxy(this._onMyGridMouseEnter,this),"mouseleave.wijcalendar":a.proxy(this._onMyGridMouseLeave,this)})}},_isSelectable:function(a){var b=this.options;return b.showOtherMonthDays&&a&c.otherMonth||!(a&(c.outOfRange|c.disabled|c.otherMonth))},_getCellClassName:function(b,h,e){var f=this.options,a="",d="ui-state-default",g=!!f.selectionMode.day||!!f.selectionMode.days;e=e||false;if(!e&&!f.disabled&&g&&this._isSelectable(b))a+=" wijmo-wijcalendar-day-selectable";if(b&c.weekEnd)a+=" ui-datepicker-week-end";if(b&c.otherMonth){a+=" ui-datepicker-other-month";d+=" ui-priority-secondary"}if(b&c.outOfRange){a+=" wijmo-wijcalendar-outofrangeday";d+=" ui-priority-secondary"}if(b&c.gap)a+=" wijmo-wijcalendar-gap";else{if(b&c.disabled){a+=" ui-datepicker-unselectable";d+=" ui-state-disabled"}if(b&c.today){a+=" ui-datepicker-days-cell-over ui-datepicker-today";d+=" ui-state-highlight"}if(b&c.selected&&(b&(c.outOfRange|c.disabled))===0){a+=" ui-datepicker-current-day";d+=" ui-state-active"}if(b&c.gap)a+=" wijmo-wijcalendar-gap";if(b&c.custom)a+=" wijmo-wijcalendar-customday"}return{cssCell:a,cssText:d}},_onNavButtonClicked:function(g){if(this._isAnimating())return false;var c=1,f=a(g.currentTarget).attr("id"),e=this.getDisplayDate(),d=e;if(this._myGrid===undefined){c=f.indexOf("quick")>=0?this.options.quickNavStep:1;c=f.indexOf("next")>=0?c:-c;c=c*this.options.monthRows*this.options.monthCols;d=b.addMonths(e,c)}else{c=f.indexOf("next")>=0?1:-1;switch(this._myGrid.gridType){case"month":d=b.addYears(e,c);break;case"year":d=b.addYears(e,c*10);break;case"decade":d=b.addYears(e,c*100)}}this._slideToDate(d);return false},_getMonthGroupHtml:function(){var f=this.getDisplayDate(),c;if(this._isSingleMonth()){c=this._getMonthView(f);c.showPreview=this.options.allowPreview&&!this.element.data("preview.wijcalendar")&&!this.options.disabled;return c.getHtml()}for(var h=100/this.options.monthCols+"%",a=new d,e,g=0;g<this.options.monthRows;g++){for(e=0;e<this.options.monthCols;e++){a.writeBeginTag("div");a.writeAttribute("class","ui-datepicker-group"+(e===0?" ui-datepicker-group-first":"")+(e===this.options.monthCols-1?" ui-datepicker-group-last":""));a.writeAttribute("style","width:"+h);a.writeTagRightChar();c=this._getMonthView(f);c.showPreview=false;a.write(c.getHtml());a.writeEndTag("div");f=b.addMonths(f,1)}a.writeBeginTag("div");a.writeAttribute("class","ui-datepicker-row-break");a.writeTagRightChar();a.writeEndTag("div")}return a.toString()},_getCalendarHtml:function(){this._createMonthViews();var a=new d;a.write(this._getMonthGroupHtml());return a.toString()},_customizeDayCell:function(a){a.attr("state")===undefined&&a.attr("state","normal");if(a.attr("daytype")===undefined)return;if(a.attr("date")===undefined)return;var b=parseInt(a.attr("daytype"),10),d=new Date(a.attr("date")),c=a.attr("state")==="hover";this.options.customizeDate(a,d,b,c)},_customize:function(c){var e=this.options,d=this,b=a(c);if(!a.isFunction(e.customizeDate))return b;a.each(b.find(".wijmo-wijcalendar-day-selectable"),function(c,b){d._customizeDayCell(a(b))});return b},_createCalendar:function(){return this._customize(a(this._getCalendarHtml()))},_createMonthGroup:function(){return this._customize(a(this._getMonthGroupHtml()))},_getMonthID:function(a){return a.getFullYear()+"_"+(a.getMonth()+1)},_createMonthViews:function(){this._monthViews={};for(var c="",a=this.getDisplayDate(),d,g=0;g<this.options.monthRows;g++)for(d=0;d<this.options.monthCols;d++){c=this._getMonthID(a);this._monthViews[c]=new e(this,a);if(g===0){if(d===0)this._monthViews[c].isFirst=true;if(d===this.options.monthCols-1)this._monthViews[c].isLast=true}a=b.addMonths(a,1)}a=this.getDisplayDate();c=this._getMonthID(a);var f=this._monthViews[c];if(f)this._groupStartDate=f.getStartDate();var h=this.options.monthRows*this.options.monthCols;if(h>1){a=b.addMonths(a,h-1);c=this._getMonthID(a);f=this._monthViews[c]}if(f)this._groupEndDate=f.getEndDate()},_getMonthView:function(b){var a=this._getMonthID(b);return this._monthViews[a]},_getId:function(){return this.element.attr("id")},_getChildElement:function(b){var a=this.element.find("[id*='"+b+"']");return a.length===0?undefined:a},_refreshDayCell:function(f){var b=a(f),i=this.options;b.attr("state")===undefined&&b.attr("state","normal");if(b.attr("daytype")===undefined)return;if(b.attr("date")===undefined)return;var d=parseInt(b.attr("daytype"),10),h=new Date(b.attr("date")),g=b.attr("state")==="hover";b.attr("class",this._getCellClassName(d,h).cssCell);b.removeAttr("aria-selected");d&c.selected&&b.attr("aria-selected",true);if(a.isFunction(i.customizeDate))if(this._customizeDayCell(b))return;var e=b.find("a");if(e.length>0){e.toggleClass("ui-state-hover",g);e.toggleClass("ui-state-active",(d&c.selected)!==0)}},_isSingleMonth:function(){return this.options.monthCols*this.options.monthRows===1},_splitString:function(f,e,b){if(b===undefined)return f.split(e);for(var c=[],d=f.split(e),a=0;a<d.length;a++)if(a>=b)c[b-1]=c[b-1]+e+d[a];else c.push(d[a]);return c},_getNavButtonHtml:function(f,e,c,b){var a=new d;a.writeBeginTag("a");a.writeAttribute("id",f);a.writeAttribute("class",e);a.writeAttribute("role","button");a.writeAttribute("href","#");if(b){a.writeAttribute("title",b);a.writeAttribute("aria-label",b)}a.writeTagRightChar();a.writeBeginTag("span");a.writeAttribute("class",c);a.writeTagRightChar();b&&a.write(b);a.writeEndTag("span");a.writeEndTag("a");return a.toString()},_getTitleText:function(d){if(this._myGrid!==undefined)return this._myGrid.getTitle();else{var b=d||this.getDisplayDate(),c=this.options.titleFormat||"MMMM yyyy";return a.isFunction(this.options.title)?this.options.title(b,c)||this._formatDate(c,b):this._formatDate(c,b)}},_refreshTitle:function(){this.element.find(".ui-datepicker-title").html(this._getTitleText())},_fillTitle:function(a,b){a.writeBeginTag("div");a.writeAttribute("class","ui-datepicker-title wijmo-wijcalendar-title ui-state-default ui-corner-all");a.writeTagRightChar();a.write(this._getTitleText(b));a.writeEndTag("div")},_getHeaderHtml:function(g,e,c){var h=!!this.element.data("preview.wijcalendar"),f=h?"none":this._isSingleMonth()?this.options.navButtons:"default",b=this.element.is(".ui-datepicker-rtl"),a=new d;if(f==="quick"){a.writeBeginTag("div");a.writeAttribute("class","ui-widget-header wijmo-wijcalendar-header ui-helper-clearfix ui-corner-all");a.writeAttribute("role","heading");a.writeTagRightChar();!!e&&a.write(this._getNavButtonHtml("quickprev","wijmo-wijcalendar-navbutton ui-datepicker-prev ui-corner-all","ui-icon ui-icon-seek-"+(b?"next":"prev"),this.options.quickPrevTooltip.replace("#",this.options.quickNavStep)));a.writeBeginTag("div");a.writeAttribute("class","ui-datepicker-header wijmo-wijcalendar-header-inner");a.writeTagRightChar();!!e&&a.write(this._getNavButtonHtml("prev","wijmo-wijcalendar-navbutton ui-datepicker-prev ui-corner-all","ui-icon ui-icon-circle-triangle-"+(b?"e":"w"),this.options.prevTooltip));this._fillTitle(a,g);!!c&&a.write(this._getNavButtonHtml("next","wijmo-wijcalendar-navbutton ui-datepicker-next ui-corner-all","ui-icon ui-icon-circle-triangle-"+(b?"w":"e"),this.options.nextTooltip));a.writeEndTag("div");!!c&&a.write(this._getNavButtonHtml("quicknext","wijmo-wijcalendar-navbutton ui-datepicker-next ui-corner-all","ui-icon ui-icon-seek-"+(b?"prev":"next"),this.options.quickNextTooltip.replace("#",this.options.quickNavStep)));a.writeEndTag("div")}else{a.writeBeginTag("div");a.writeAttribute("class","ui-datepicker-header ui-widget-header ui-datepicker-header ui-helper-clearfix ui-corner-all");a.writeAttribute("role","heading");a.writeTagRightChar();f!=="none"&&!!e&&a.write(this._getNavButtonHtml("prev","wijmo-wijcalendar-navbutton ui-datepicker-prev ui-corner-all","ui-icon ui-icon-circle-triangle-"+(b?"e":"w"),this.options.prevTooltip));this._fillTitle(a,g);f!=="none"&&!!c&&a.write(this._getNavButtonHtml("next","wijmo-wijcalendar-navbutton ui-datepicker-next ui-corner-all","ui-icon ui-icon-circle-triangle-"+(b?"w":"e"),this.options.nextTooltip));a.writeEndTag("div")}return a.toString()},_formatDate:function(c,a){return!b.getTicks(a)?"&nbsp;":Globalize.format(a,c,this._getCulture())}});var d=function(){this._html=[]};d.prototype={_html:null,writeTagLeftChar:function(){this._html[this._html.length]="<"},writeTagRightChar:function(){this._html[this._html.length]=">"},write:function(a){this._html[this._html.length]=" "+a+" "},writeBeginTag:function(a){this._html[this._html.length]="<"+a},writeEndTag:function(a){this._html[this._html.length]="</"+a+">"},writeFullBeginTag:function(a){this._html[this._html.length]="<"+a+">"},writeSelfClosingTagEnd:function(){this._html[this._html.length]="/>"},writeAttribute:function(b,a){if(a===undefined||a===null)return;this._html[this._html.length]=" "+b+'="';this._html[this._html.length]=a;this._html[this._html.length]='"'},clean:function(){this._html=[]},toString:function(){return this._html.join("")}};var b={addDays:function(a,c){var b=new Date(a.getFullYear(),a.getMonth(),a.getDate()+c);if(c)if(b.getDate()===a.getDate()){b=new Date(a.getFullYear(),a.getMonth(),a.getDate());b.setTime(b.getTime()+c*864e5)}return b},addMonths:function(a,b){return new Date(a.getFullYear(),a.getMonth()+b,1)},addYears:function(b,a){return this.addMonths(b,a*12)},getDate:function(a){return new Date(a.getFullYear(),a.getMonth(),a.getDate())},getTicks:function(a){return a.valueOf()},isSameDate:function(a,b){return a.getFullYear()===b.getFullYear()&&a.getMonth()===b.getMonth()&&a.getDate()===b.getDate()},isSameMonth:function(a,b){return a.getFullYear()===b.getFullYear()&&a.getMonth()===b.getMonth()},getDaysInMonth:function(a){return new Date(a.getFullYear(),a.getMonth()+1,0).getDate()},getWeekStartDate:function(a,b){return new Date(a.getFullYear(),a.getMonth(),a.getDate()-(a.getDay()-b+7)%7)},getDayOfYear:function(a){var c=new Date(a.getFullYear(),0,1),b=this.getTicks(a)-this.getTicks(c),d=b/864e5;return Math.floor(d)+1},getFirstDayWeekOfYear:function(b,d){var c=this.getDayOfYear(b)-1,a=b.getDay()-c%7;a=(a-d+14)%7;var e=(c+a)/7;return Math.floor(e)+1},getDayOfWeek:function(b,a){return(b.getDay()-a+7)%7},getWeekOfYearFullDays:function(d,f,b,e){var c=this.getDayOfYear(d)-1,a=this.getDayOfWeek(d,b)-c%7;a=(b-a+14)%7;if(a&&a>=e)a-=7;a=c-a;return a>=0?Math.floor(a/7)+1:this.getWeekOfYearFullDays(this.addDays(d,-(c+1)),f,b,e)},getWeekOfYear:function(b,c,a){switch(c){case"firstDay":return this.getFirstDayWeekOfYear(b,a);case"firstFullWeek":return this.getWeekOfYearFullDays(b,c,a,7);case"firstFourDayWeek":return this.getWeekOfYearFullDays(b,c,a,4)}return this.getFirstDayWeekOfYear(b,a)},getDateToken:function(a){return a.getFullYear()+"_"+a.getMonth()+"_"+a.getDate()}},e=function(c,a){this.calendar=c;if(a===undefined||b.isSameDate(a,new Date(1900,0,1)))a=new Date;this.displayDate=a;this.id=this.calendar._getId()+"_"+this.calendar._getMonthID(a);this.isFirst=false;this.isLast=false;this.showPreview=false;this.culture=this.calendar._getCulture();this._calcDates(this.displayDate)};e.prototype={_calcDates:function(a){var c=b.getDaysInMonth(a);this._startDateInMonth=new Date(a.getFullYear(),a.getMonth(),1);this._endDateInMonth=b.addDays(this._startDateInMonth,c-1);this._startDate=b.getWeekStartDate(this._startDateInMonth,this.culture.calendar.firstDay);this._endDate=b.addDays(this._startDate,this.calendar.options.dayRows*this.calendar.options.dayCols-1)},_isFirstMonth:function(){var a=this.calendar.getDisplayDate();return b.isSameMonth(this._startDateInMonth,a)},_isLastMonth:function(){var a=this.calendar.getDisplayDate();a=new Date(a.getFullYear(),a.getMonth(),1);a=b.addMonths(a,this.calendar.options.monthCols*this.calendar.options.monthRows-1);return b.isSameMonth(this._startDateInMonth,a)},getStartDate:function(){return this._startDate},getEndDate:function(){return this._endDate},_getMonthDate:function(){this._startDateInMonth===undefined&&this._calcDates(this.getDisplayDate());return this._startDateInMonth},_setMonthDate:function(a){this._calcDates(a)},_getWeekDayText:function(c,d){d=d||"short";var b=this.culture.calendar.days,a="";switch(d){case"full":a=b.names[c];break;case"firstLetter":a=b.names[c].substring(0,1);break;case"abbreviated":a=b.namesAbbr[c];break;default:a=b.namesShort[c]}return a},_getRowCount:function(){var a=this.calendar.options;return a.showWeekDays?a.dayRows+1:a.dayRows},_getColCount:function(){var a=this.calendar.options;return a.showWeekNumbers?a.dayCols+1:a.dayCols},_getDayType:function(d){var e=this.calendar.options,a=c.general,h=d.getDay(),m=h===6||h===0,g=d<e.minDate||d>e.maxDate,f=d<this._startDateInMonth||d>this._endDateInMonth,i=g||this.calendar._getDisabledDates().contains(d),j=this.calendar._getSelectedDates().contains(d),n=new Date,l=b.isSameDate(d,n),k=false;if(m)a|=c.weekEnd;if(l)a|=c.today;if(i)a|=c.disabled;if(f)a|=c.otherMonth;if(g)a|=c.outOfRange;if(j)a|=c.selected;if(k)a|=c.custom;if(f&&!e.showOtherMonthDays)a|=c.gap;return a},_refreshDate:function(b){if(b<this._startDate||b>this._endDate)return;var h=this.calendar.options,g=Math.round(Math.abs(b-this._startDate)/864e5),d=Math.floor(g/this.calendar.options.dayCols),c=Math.floor(g%this.calendar.options.dayCols);if(h.showWeekNumbers)c++;if(h.showWeekDays)d++;var e=a("#"+this.id,this.calendar.element).get(0);if(e)if(d<e.rows.length){var i=e.rows[d];if(c<i.cells.length){var f=i.cells[c],j=this._getDayType(b);a(f).attr("daytype",j.toString());this.calendar._refreshDayCell(f)}}},_fillDayCell:function(a,b,k){var j=this.calendar.options,f=null,d=b.getDate().toString(),h=this.calendar._formatDate(j.toolTipFormat||"dddd, MMMM dd, yyyy",b),e=this._getDayType(b),g=this.calendar._isSelectable(e),i=this.calendar._getCellClassName(e,b,k);d=j.showDayPadding&&d.length===1?"0"+d:d;a.writeBeginTag("td");a.writeAttribute("daytype",e.toString());if(g){a.writeAttribute("title",h);a.writeAttribute("aria-label",h)}a.writeAttribute("date",b.toDateString());a.writeAttribute("class",i.cssCell);a.writeAttribute("role","gridcell");!g&&a.writeAttribute("aria-disabled","true");a.writeTagRightChar();if(e&c.gap)a.write("&#160;");else if(f&&f.content)a.write(f.content);else{a.writeBeginTag("a");a.writeAttribute("class",i.cssText);a.writeAttribute("href","#");a.writeAttribute("onclick","return false;");a.writeTagRightChar();a.write(d);a.writeEndTag("a")}a.writeEndTag("td")},getHtml:function(g){g=!!g;var c=this.calendar.options,h=!!this.calendar.element.data("preview.wijcalendar"),a=new d,e,k;!g&&c.showTitle&&a.write(this.calendar._getHeaderHtml(this._startDateInMonth,this.isFirst,this.isLast));if(!g&&!h&&this.showPreview){a.writeBeginTag("div");a.writeAttribute("class","wijmo-wijcalendar-prevpreview-button");a.writeAttribute("role","button");a.writeAttribute("aria-haspopup","true");a.writeAttribute("id","prevPreview");a.writeTagRightChar();a.writeBeginTag("a");a.writeAttribute("class","ui-icon ui-icon-grip-dotted-vertical");a.writeAttribute("href","#");a.writeAttribute("title",c.prevPreviewTooltip);a.writeAttribute("aria-label",c.prevPreviewTooltip);a.writeAttribute("onclick","return false;");a.writeTagRightChar();a.write("&#160;");a.writeEndTag("a");a.writeEndTag("div")}a.writeBeginTag("table");a.writeAttribute("id",this.id);a.writeAttribute("class","ui-datepicker-calendar wijmo-wijcalendar-table");a.writeAttribute("role","grid");a.writeAttribute("summary",this.calendar._getTitleText(this._startDateInMonth));a.writeAttribute("onselectstart","return false;");a.writeTagRightChar();if(c.showWeekDays){a.writeFullBeginTag("thead");a.writeBeginTag("tr");a.writeTagRightChar();if(c.showWeekNumbers){a.writeBeginTag("th");a.writeAttribute("id",this.id+"_ms");a.writeAttribute("class","ui-datepicker-week-col wijmo-wijcalendar-monthselector"+(!!c.selectionMode.month?" wijmo-wijcalendar-selectable":""));a.writeAttribute("role","columnheader");a.writeTagRightChar();if(!!c.selectionMode.month&&!h&&!c.disabled){a.writeBeginTag("a");a.writeAttribute("class","ui-icon ui-icon-triangle-1-se");a.writeSelfClosingTagEnd()}else a.write("Wk");a.writeEndTag("th")}var f=this._startDate.getDay(),l=this._startDate;for(e=0;e<c.dayCols;e++){var q=f===6||f===0,o=e+(c.showWeekNumbers?1:0),r=this._getWeekDayText(f,c.weekDayFormat),m=this._getWeekDayText(f,"full");a.writeBeginTag("th");a.writeAttribute("id",this.id+"_cs_"+o);a.writeAttribute("class","ui-datepicker-week-day"+(q?" ui-datepicker-week-end":"")+(!!c.selectionMode.weekDay?" wijmo-wijcalendar-selectable":""));a.writeAttribute("role","columnheader");a.writeTagRightChar();a.writeBeginTag("span");a.writeAttribute("title",m);a.writeAttribute("aria-label",m);a.writeTagRightChar();a.write(r);a.writeEndTag("span");a.writeEndTag("th");f=(f+1)%7;l=b.addDays(l,1)}a.writeEndTag("tr");a.writeEndTag("thead")}a.writeFullBeginTag("tbody");var j=this._startDate,i=this._startDateInMonth;for(e=0;e<c.dayRows;e++){a.writeBeginTag("tr");a.writeTagRightChar();if(c.showWeekNumbers){var p=e+(c.showWeekDays?1:0);a.writeBeginTag("td");a.writeAttribute("id",this.id+"_rs_"+p);a.writeAttribute("class","ui-datepicker-week-col wijmo-wijcalendar-week-num"+(!!c.selectionMode.weekNumber?" wijmo-wijcalendar-selectable":""));a.writeAttribute("role","rowheader");a.writeTagRightChar();var n=b.getWeekOfYear(i,c.calendarWeekRule,this.culture.calendar.firstDay);a.write(n);a.writeEndTag("td");i=b.addDays(i,c.dayCols)}for(k=0;k<c.dayCols;k++){this._fillDayCell(a,j,h);j=b.addDays(j,1)}a.writeEndTag("tr")}a.writeEndTag("tbody");a.writeEndTag("table");if(!g&&!h&&this.showPreview){a.writeBeginTag("div");a.writeAttribute("class","wijmo-wijcalendar-nextpreview-button");a.writeAttribute("role","button");a.writeAttribute("aria-haspopup","true");a.writeAttribute("id","nextPreview");a.writeTagRightChar();a.writeBeginTag("a");a.writeAttribute("class","ui-icon ui-icon-grip-dotted-vertical");a.writeAttribute("href","#");a.writeAttribute("title",c.nextPreviewTooltip);a.writeAttribute("aria-label",c.nextPreviewTooltip);a.writeAttribute("onclick","return false;");a.writeTagRightChar();a.write("&#160;");a.writeEndTag("a");a.writeEndTag("div")}return a.toString()}};var f=function(b,a){this._calendar=b;this._optionName=a;this._normalize()};f.prototype={_calendar:null,_optionName:"selectedDates",getDates:function(){if(this._calendar.options[this._optionName]===undefined)this._calendar.options[this._optionName]=[];return this._calendar.options[this._optionName]},setDates:function(a){this._calendar.options[this._optionName]=a;this._normalize()},getCount:function(){return this.getDates().length},clear:function(){this.setDates([])},add:function(a){this.addRange(a,a)},remove:function(a){this.removeRange(a,a)},indexOf:function(a){return!this.getCount()?-1:this._findRangeBound(a,true,false)},contains:function(a){return this.indexOf(a)!==-1},removeRange:function(g,d){if(!this.getCount())return;var b=this._findRangeBound(g,false,true),a=this._findRangeBound(d,false,false);if(b<0||a<0)return;if(b>a)return;var c=this.getDates();if(c[a]>d)return;var e=!b?[]:c.slice(0,b),f=a>=c.length-1?[]:c.slice(a+1);this.setDates(e.concat(f))},addRange:function(c,d){this.removeRange(c,d);var g=this.getDates(),e=this._findRangeBound(c,false,true),h=!e?[]:g.slice(0,e),i=g.slice(e),f=[],a;c=b.getDate(c);d=b.getDate(d);for(a=c;a<=d;a=b.addDays(a,1))f[f.length]=a;this.setDates(h.concat(f.concat(i)))},_findRangeBound:function(f,h,g){var e=this.getDates(),c=0,d=e.length,a;while(c<d){a=c+d>>1;if(b.isSameDate(f,e[a]))return a;if(f<e[a])d=a;else c=a+1}return h?-1:g?c:d},_parseDate:function(a){var b;if(!a)a=new Date;else if(typeof a==="string")b=a;if(b){b=b.replace(/-/g,"/");try{a=new Date(b);if(isNaN(a))a=new Date}catch(c){a=new Date}}return a},_normalize:function(){var b=this._calendar.options[this._optionName],d=this;if(a.isArray(b)){var c=a.map(b,function(a){return d._parseDate(a)});this._calendar.options[this._optionName]=c.sort(function(a,b){return a.getTime()-b.getTime()})}}};var g=function(a){this.gridType="month";this.calendar=a;this.culture=a._getCulture()};g.prototype={gridType:"month",calendar:null,culture:undefined,select:function(c,b){var a=this.calendar.getDisplayDate();switch(this.gridType){case"month":a.setMonth(b);break;case"year":a.setFullYear(b);break;case"decade":a.setFullYear(b)}this.calendar.options.displayDate=a},getSelectedIndex:function(){var b=this.calendar.getDisplayDate(),a=b.getFullYear(),d=Math.floor(a/10)*10-1,c=Math.floor(a/100)*100-10;switch(this.gridType){case"month":return b.getMonth();case"year":return a-d;case"decade":return Math.floor((a-c)/10)}return 0},getTitle:function(){var d=this.calendar.getDisplayDate(),a=d.getFullYear(),c=Math.floor(a/10)*10-1,b=Math.floor(a/100)*100-10;switch(this.gridType){case"month":return a.toString();case"year":return c+1+" - "+(c+10);case"decade":return b+10+" - "+(b+109)}return""},getHtml:function(g,j){if(g===undefined)g=this.calendar.getDisplayDate();else if(typeof g==="boolean"){j=g;g=this.calendar.getDisplayDate()}j=!!j;var e=this.calendar.options,a=new d;e.showTitle&&!j&&a.write(this.calendar._getHeaderHtml(null,true,true));var q=3,t=4,p=100/q+"%";p="30%";a.writeBeginTag("table");a.writeAttribute("class","ui-datepicker-calendar wijmo-wijcalendar-mygrid");a.writeAttribute("role","grid");a.writeAttribute("onselectstart","return false;");a.writeTagRightChar();for(var h=g.getFullYear(),o=g.getFullYear()*12,s=Math.floor(h/10)*10-1,r=Math.floor(h/100)*100-10,u=this.culture.calendar.months,m,n=0;n<q;n++){a.writeBeginTag("tr");a.writeAttribute("height",p);a.writeTagRightChar();for(m=0;m<t;m++){var c=n*4+m,l=false,f=false,k="",b;switch(this.gridType){case"month":if(g.getMonth()===c)l=true;b=c;k=u.namesAbbr[c];f=o+c<e.minDate.getFullYear()*12+e.minDate.getMonth()||o+c>e.maxDate.getFullYear()*12+e.maxDate.getMonth();break;case"year":if(c===0||c===11)f=true;b=s+c;if(b<e.minDate.getFullYear()||b>e.maxDate.getFullYear())f=true;else l=h===b;k=b.toString();break;case"decade":if(c===0||c===11)f=true;b=r+c*10;if(b+10<e.minDate.getFullYear()||b>e.maxDate.getFullYear())f=true;else l=h>=b&&h<b+10;k=b.toString()+"-<br/>"+(b+9).toString()}var i="ui-datepicker-week-day";if(f)i=i+" ui-datepicker-other-month  ui-priority-secondary ui-datepicker-unselectable";else if(!e.disabled)i+=" wijmo-wijcalendar-day-selectable";i+=" ui-state-default"+(f?" ui-state-disabled":"")+(l?" ui-state-active ui-state-highlight":"");a.writeBeginTag("td");a.writeAttribute("class",i);a.writeAttribute("role","gridcell");a.writeAttribute("index",c.toString());a.writeAttribute("value",b.toString());a.writeAttribute("other",f.toString());a.writeTagRightChar();a.writeBeginTag("a");a.writeAttribute("href","#");a.writeTagRightChar();a.write(k);a.writeEndTag("a");a.writeEndTag("td")}a.writeEndTag("tr")}a.writeEndTag("table");return a.toString()}}})(jQuery);