$('#student_<%= @student_id %> td.total_points').html('<%= @student_total_score %>');
$('#student_<%= @student_id %> td.weighted_scores').html('<%= @student_weights_total %>');

var CalculateAverage, CalculateDeviation, FixDigit, total_score_average, total_weights_average;

FixDigit = function(num, digit_num) {
  var fix;
  fix = Math.pow(10, digit_num);
  return Math.floor(num * fix) / fix;
};

CalculateAverage = function(nums) {
  var i, total;
  total = 0.0;
  i = 0;
  while (i < nums.length) {
    total += parseFloat(nums[i].innerText);
    i++;
  }
  return total / nums.length;
};

CalculateDeviation = function(scoreAve, weightedAve) {
  var average, deviation, i, scores, stdDev, _results;
  stdDev = 0.0;
  if ($("#weighting_total_title").text()) {
    scores = $(".weighted_scores");
    average = weightedAve;
  } else {
    scores = $(".total_points");
    average = scoreAve;
  }
  i = 0;
  while (i < scores.length) {
    stdDev += Math.pow(parseFloat($(scores[i]).text()) - average, 2);
    i++;
  }
  stdDev = Math.sqrt(stdDev / scores.length);
  deviation = 0.0;
  i = 0;
  _results = [];
  while (i < scores.length) {
    deviation = (parseFloat($(scores[i]).text()) - average) / stdDev;
    if (isNaN(deviation)) {
      deviation = 50;
    } else {
      deviation = deviation * 10 + 50;
    }
    $(scores[i]).nextAll("#deviation").text(Math.floor(deviation));
    _results.push(i++);
  }
  return _results;
};

total_score_average = CalculateAverage($(".total_points"));

$(".total_points_average").html(FixDigit(total_score_average, 2));

total_weights_average = CalculateAverage($(".weighted_scores"));

$(".weighted_scores_average").html(FixDigit(total_weights_average, 2));

CalculateDeviation(total_score_average, total_weights_average);
