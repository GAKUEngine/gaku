/*
 *
 * Wijmo Library 2.0.0
 * http://wijmo.com/
 *
 * Copyright(c) ComponentOne, LLC.  All rights reserved.
 * 
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * licensing@wijmo.com
 * http://www.wijmo.com/license
 *
 **/
(function(a){"use strict";var g="ui-widget ui-widget-content ui-corner-all wijmo-wijlist",c="wijmo-wijlist-item",h=c+"-alternate",i=c+"-selected",j=c+"-first",k=c+"-last",f="ui-state-hover",l="ui-state-active",e="wijmo-wijlistitem-active",b=i+" "+l,d="item.wijlist";a.widget("wijmo.wijlist",{options:{listItems:[],selected:null,selectionMode:"single",autoSize:false,maxItemsCount:5,addHoverItemClass:true,superPanelOptions:null,disabled:false,focusing:null,focus:null,blur:null,itemRendering:null,itemRendered:null,listRendered:null,keepHightlightOnMouseLeave:false},removeAll:function(){var a=this;a.items=[];a._refresh()},addItem:function(c,b){var a=this;a._checkData();if(b===null)a.items.push(c);else a.items&&a.items.splice(b,0,c);a._refresh()},removeItem:function(c){var b=this,a;b._checkData();a=b.indexOf(c);a>=0&&b.removeItemAt(a)},indexOf:function(e){var c=this,d=-1,a=0,b;c._checkData();for(a=0;a<c.items.length;a++){b=c.items[a];if(b.label===e.label&&b.value===e.value){d=a;break}}return d},removeItemAt:function(b){var a=this;a._checkData();a.items.splice(b,1);a._refresh()},_checkData:function(){var a=this;if(a.items===null)a.items=[]},_refresh:function(){var a=this;a.renderList();a.refreshSuperPanel()},_setOption:function(d,c){var b=this;a.Widget.prototype._setOption.apply(b,arguments);d==="disabled"&&b._handleDisabledOption(c,b.element)},_create:function(){var b=this,c=this.element,d=this.options;c.addClass(g).attr({role:"listbox","aria-activedescendant":e,"aria-multiselectable":d.selectionMode==="multiple"}).bind("click."+b.widgetName,b,b._onListClick);if(c.is("div")&&c.children().is("ul")){b._isInnerData=true;b._templates=[];a.each(a("ul > li",c),function(c,a){b._templates.push({templateHtml:a.innerHTML})});b._oriChildren=c.children().hide()}b.ul=a("<ul class='wijmo-wijlist-ul'></ul>").appendTo(c);if(d.listItems!==null)if(d.listItems.length>0){b.setItems(d.listItems);b.renderList();b.refreshSuperPanel()}d.disabled&&b.disable()},_handleDisabledOption:function(b,c){var a=this;if(b){if(!a.disabledDiv)a.disabledDiv=a._createDisabledDiv(c);a.disabledDiv.appendTo("body")}else if(a.disabledDiv){a.disabledDiv.remove();a.disabledDiv=null}},_createDisabledDiv:function(f){var g=this,b=f||g.element,c=b.offset(),e=b.outerWidth(),d=b.outerHeight();return a("<div></div>").addClass("ui-disabled").css({"z-index":"99999",position:"absolute",width:e,height:d,left:c.left,top:c.top})},setTemplateItems:function(a){this._setItemsByExtend(a,true)},setItems:function(a){this._setItemsByExtend(a,false)},_setItemsByExtend:function(c,e){var b=this,d;if(e){if(b._templates&&c&&c.length!==b._templates.length)return;b.items=c;if(!b.items)b.items=[];a.each(b._templates,function(a){if(b.items[a])b.items[a].templateHtml=b._templates[a].templateHtml;else b.items.push({templateHtml:b._templates[a].templateHtml})})}else b.items=c;if(!c)return null;d=a.grep(c,function(a){return a.selected});if(b.options.selectionMode==="single"){b.selectedItems=[];b.selectedItem=d.length>0?d[0]:undefined}else b.selectedItems=d},popItem:function(){var a=this;a._checkData();a.items.pop();a._refresh()},getList:function(){return this.ul},_onListClick:function(b){if(!a(b.target).closest(".wijmo-wijlist-item").length)return;var c=b.data;c.select(b)},destroy:function(){var b=this,c=this.element;b.superPanel!==undefined&&b.superPanel.destroy();c.removeClass(g).removeAttr("role").removeAttr("aria-activedescendant").unbind("."+b.widgetName);b.ul.remove();if(b.disabledDiv){b.disabledDiv.remove();b.disabledDiv=null}b._isInnerData&&b._oriChildren.show();a.Widget.prototype.destroy.apply(b,arguments)},activate:function(d,b,g){var a=this,h,c;a.deactivate();if(b===null||b===undefined)return;if(a._trigger("focusing",d,b)===false)return;h=a.active=b;c=b.element;a.options.addHoverItemClass&&c.addClass(f);c.attr("id",e);g&&a.superPanel!==undefined&&a.superPanel.scrollChildIntoView(c);a._trigger("focus",d,b)},deactivate:function(){var a=this,c=a.active,b;if(!c)return;b=c.element;a._trigger("blur",null,c);b&&b.removeClass(f).removeAttr("id");a.active=undefined},next:function(a){this.move("next","."+c+":first",a)},nextPage:function(){this.superPanel.doScrolling("bottom",true)},previous:function(a){this.move("prev","."+c+":last",a)},previousPage:function(){this.superPanel.doScrolling("top",true)},first:function(){return this.active&&!this.active.element.prev().length},last:function(){return this.active&&!this.active.element.next().length},move:function(h,f,b){var a=this,g,e;if(!a.active){g=a.ul.children(f).data(d);a.activate(b,g,true);return}e=a.active.element[h+"All"]("."+c).eq(0);if(e.length)a.activate(b,e.data(d),true);else a.activate(b,a.element.children(f).data(d),true)},select:function(j,k){var e=this,g=e.active.element,h,c,i,f;if(g===undefined)return;c=g.data(d);i=e.options.selectionMode==="single";if(i){f=e.selectedItem;g.addClass(b).attr("aria-selected","true");c.selected=true;if(f!==undefined&&c!==f){f.selected=false;f.element.removeClass(b).removeAttr("aria-selected")}e.selectedItem=c;h=a.inArray(c,e.items);e._trigger("selected",j,{item:c,previousItem:f,selectedIndex:h,data:k})}else{c.selected=!c.selected;if(c.selected)g.addClass(b).attr("aria-selected","true");else g.removeClass(b).removeAttr("aria-selected","true");e.selectedItems=a.grep(e.items,function(a){return a.selected});e._trigger("selected",j,{item:c,selectedItems:e.selectedItems})}},_findItemsByValues:function(c){var b,d=[];d=a.grep(this.items,function(d){b=false;for(var a=0;a<c.length;a++)if(d.value===c[a])b=true;return b});return d},_findItemsByIndices:function(c){var d=this,e=this.items.length,b=[];a.each(c,function(c,a){a>=0&&a<e&&b.push(d.items[a])});return b},getItems:function(b){var g=this,f,c,d,e;c=a.isArray(b);f=!c&&!isNaN(b)||c&&!isNaN(b[0]);d=c?b:[b];e=f?g._findItemsByIndices(d):g._findItemsByValues(d);return e},selectItems:function(i,g){var c=this,h=this.options.selectionMode==="single",e,d,f;f=c.getItems(i);if(h){if(f.length>0){e=f[0];e.selected=true;e.element.addClass(b)}d=c.selectedItem;if(d){d.selected=false;d.element.removeClass(b)}c.selectedItem=e;g&&c._trigger("selected",null,{item:e,previousItem:d})}else{a.each(f,function(c,a){a.selected=true;a.element.addClass(b)});c.selectedItems=a.grep(c.items,function(a){return a.selected});g&&c._trigger("selected",null,{selectedItems:c.selectedItems})}},unselectItems:function(f){var c=this,g=this.options.selectionMode,d,e;if(g==="single"){d=c.selectedItem;if(d){d.selected=false;d.element.removeClass(b);c.selectedItem=undefined}}else{e=c.getItems(f);a.each(e,function(c,a){a.selected=false;a.element.removeClass(b)});c.selectedItems=a.grep(c.items,function(a){return a.selected})}},renderList:function(){var d=this,g=this.ul,h=this.options,a,b,e,c,f;g.empty();a=d.items;if(a===undefined)return;b=a.length;if(a===undefined||a===null&&b===0)return;e=h.selectionMode==="single";for(c=0;c<b;c++){f=a[c];d._renderItem(g,f,c,e)}if(b>0){a[0].element.addClass(j);a[b-1].element.addClass(k)}d._trigger("listRendered",null,d)},_renderItem:function(k,c,j){var e=this,f=a("<li role='option' class='wijmo-wijlist-item ui-corner-all'></li>"),g,i;c.element=f;c.list=e;if(e._trigger("itemRendering",null,c)===false)return;g=c.label;if(c.templateHtml)g=c.templateHtml;else if(c.text!==undefined)g=c.text;f.bind("mouseover",function(a){e.activate(a,c,false)}).bind("mouseout",function(){!e.options.keepHightlightOnMouseLeave&&e.deactivate()}).data(d,c).append(g).appendTo(k);if(!e._isInnerData){i=c.imageUrl;i!==undefined&&i.length>0&&f.prepend("<img src='"+c.imageUrl+"'>")}if(c.selected){e.activate(null,c,false);f.addClass(b)}j%2===1&&f.addClass(h);e._trigger("itemRendered",null,c)},refreshSuperPanel:function(){var d=this,f=this.element,m=this.options,b=this.ul,n=b.children(".wijmo-wijlist-item:first"),h=null,g,j,k,c,e,i,l;if(!f.is(":visible"))return false;if(m.autoSize)h=n.outerHeight(true)*m.maxItemsCount;h!==null&&f.height(Math.min(h,b.outerHeight()));g=f.innerHeight();j=g/(b.outerHeight()-g);e=101*j/(1+j);k=n.outerHeight()/(b.outerHeight()-g)*(101-e);if(d.superPanel===undefined){i={allowResize:false,keyboardSupport:false,bubbleScrollingEvent:true,hScroller:{scrollBarVisibility:"hidden"},vScroller:{scrollSmallChange:k,scrollLargeChange:e}};a.extend(i,m.superPanelOptions);d.superPanel=f.wijsuperpanel(i).data("wijsuperpanel")}else{c=d.superPanel.options.vScroller;c.scrollLargeChange=e;c.scrollSmallChange=k;d.superPanel.paintPanel()}l=b.css("padding-top");if(l.length>0){c=d.superPanel.options.vScroller;c.firstStepChangeFix=d.superPanel.scrollPxToValue(parseFloat(l),"v")}else c.firstStepChangeFix=0;b.setOutWidth(b.parent().parent().innerWidth())}})})(jQuery);