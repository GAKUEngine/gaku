/*
 *
 * Wijmo Library 2.0.0
 * http://wijmo.com/
 *
 * Copyright(c) ComponentOne, LLC.  All rights reserved.
 * 
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * licensing@wijmo.com
 * http://www.wijmo.com/license
 *
 **/
(function(b){"use strict";var a,c,d,j=false,i=false,h,f,e,g;b.widget("wijmo.wijvideo",{_create:function(){var i=this,n,k,l,m;if(b(this.element).is("video"))a=b(this.element);else a=b(this.element).find("video");if(!a||a.length===0||b.browser.msie&&b.browser.version<9)return;l=a[0].canPlayType;if(!l)return;a.wrap('<div class="wijmo-wijvideo ui-widget-content ui-widget" />').after('<div class="wijmo-wijvideo-wrapper"><ul class="wijmo-wijvideo-controls ui-widget-header ui-helper-clearfix ui-helper-reset"><li class="wijmo-wijvideo-play ui-state-default ui-corner-all"><span class="ui-icon ui-icon-play"></span></li><li class="wijmo-wijvideo-index"><div class="wijmo-wijvideo-index-slider"></div></li><li class="wijmo-wijvideo-timer">00:00</li><li class="wijmo-wijvideo-volume ui-state-default ui-corner-all"><div class="wijmo-wijvideo-volume-container"><div class="wijmo-wijvideo-volumeslider ui-state-default ui-corner-top"></div></div><span class="ui-icon ui-icon-volume-on"></span></li><li class="wijmo-wijvideo-fullscreen ui-state-default ui-corner-all"><span class="ui-icon ui-icon-arrow-4-diag"></span></li></ul></div>');c=a.parent(".wijmo-wijvideo");c.width(a.outerWidth()).height(a.outerHeight());d=c.find(".wijmo-wijvideo-index-slider");i._volumnOn=true;e=c.find(".wijmo-wijvideo-volume");m=window.setInterval(function(){if(i._getVideoAttribute("readyState")){window.clearInterval(m);c.width(a.outerWidth()).height(a.outerHeight());a.parent().find(".wijmo-wijvideo-controls").show();n=c.find(".wijmo-wijvideo-timer").position().left;d.width(n-d.position().left-15);d.slider({value:0,step:.01,max:i._getVideoAttribute("duration"),range:"min",stop:function(b,a){j=false;i._setVideoAttribute("currentTime",a.value)},slide:function(){j=true}});i._updateTime();f=c.find(".wijmo-wijvideo-volumeslider");f.slider({min:0,max:1,value:i._getVideoAttribute("volume"),step:.1,orientation:"vertical",range:"min",slide:function(b,a){i._setVideoAttribute("volume",a.value);if(a.value===0){i._volumnOn=false;e.find("span").removeClass("ui-icon-volume-on").addClass("ui-icon-volume-off")}else{i._volumnOn=true;e.find("span").removeClass("ui-icon-volume-off").addClass("ui-icon-volume-on")}}});a.parent().find(".wijmo-wijvideo-controls").css("display","none");i._initialToolTip()}},200);a.bind("click."+i.widgetName,function(){i._togglePlay()});b(".wijmo-wijvideo").hover(function(){b(".wijmo-wijvideo-controls").stop(true,true).fadeIn()},function(){b(".wijmo-wijvideo-controls").delay(300).fadeOut()});k=c.find(".wijmo-wijvideo-play > span");k.click(function(){i._togglePlay()}).parent().hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")});c.find(".wijmo-wijvideo-volume").hover(function(){b(".wijmo-wijvideo-volume-container").stop(true,true).slideToggle()});g=c.find(".wijmo-wijvideo-fullscreen > span");g.click(function(){i._toggleFullScreen()}).parent().hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")});e.hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")}).click(function(){if(i._getVideoAttribute("readyState")){i._volumnOn=!i._volumnOn;if(!i._volumnOn){h=f.slider("value");f.slider("value",0);a.attr("volume",0);e.find("span").removeClass("ui-icon-volume-on").addClass("ui-icon-volume-off")}else{f.slider("value",h);a.attr("volume",h);e.find("span").removeClass("ui-icon-volume-off").addClass("ui-icon-volume-on")}}});a.bind("play."+i.widgetName,function(){k.removeClass("ui-icon ui-icon-play").addClass("ui-icon ui-icon-pause")});a.bind("pause."+i.widgetName,function(){k.removeClass("ui-icon ui-icon-pause").addClass("ui-icon ui-icon-play")});a.bind("ended."+i.widgetName,function(){i.pause()});a.bind("timeupdate."+i.widgetName,function(){i._updateTime()});i._videoIsControls=false;if(i._getVideoAttribute("controls"))i._videoIsControls=true;a.removeAttr("controls")},_getVideoAttribute:function(b){return b===""?void 0:a.attr(b)!==undefined?a.attr(b):a.prop(b)},_setVideoAttribute:function(b,c){return b===""?void 0:a.attr(b)!==undefined?a.attr(b,c):a.prop(b,c)},_initialToolTip:function(){var a=this;d.wijtooltip({mouseTrailing:true,showCallout:false,position:{offset:"-60 -60"}});d.bind("mousemove",function(b){a._changeToolTipContent(b)});e.wijtooltip({content:"Volume",showCallout:false});g.wijtooltip({content:"Full Screen",showCallout:false});d.wijtooltip("widget").addClass("wijmo-wijvideo");e.wijtooltip("widget").addClass("wijmo-wijvideo");e.wijtooltip("widget").addClass("wijmo-wijvideo")},_updateTime:function(){var g=this,i=g._getVideoAttribute("duration"),b=g._getVideoAttribute("currentTime"),a,e,f="",h="";a=this._truncate((i-b)/60);e=this._truncate(i-b-a*60);if(a<10)f="0";if(e<10)h="0";c.find(".wijmo-wijvideo-timer").html(f+a+":"+h+e);!j&&d.slider("value",b)},_truncate:function(a){return Math[a>0?"floor":"ceil"](a)},_togglePlay:function(){var a=this;if(!a._getVideoAttribute("readyState"))return;if(a._getVideoAttribute("paused"))this.play();else this.pause()},_toggleFullScreen:function(){var d=this,h=d._getVideoAttribute("paused"),e=0,f=b(window).width(),g=b(window).height();i=!i;if(i){d._oriVidParentStyle=c.attr("style");d._oriWidth=a.outerWidth();d._oriHeight=a.outerHeight();d._oriDocOverFlow=b(document.documentElement).css("overflow");b(document.documentElement).css({overflow:"hidden"});if(!d._replacedDiv)d._replacedDiv=b("<div />");c.after(d._replacedDiv);c.addClass("wijmo-wijvideo-container-fullscreen").css({width:f,height:g}).appendTo(b("body"));a.attr("width",f).attr("height",g);b(window).bind("resize.wijvideo",function(){d._fullscreenOnWindowResize()});e=f-d._oriWidth}else{b(document.documentElement).css({overflow:d._oriDocOverFlow});e=d._oriWidth-a.width();d._replacedDiv.after(c).remove();c.removeClass("wijmo-wijvideo-container-fullscreen").attr("style","").attr("style",d._oriVidParentStyle);a.attr("width",d._oriWidth).attr("height",d._oriHeight);b(window).unbind("resize.wijvideo")}d._positionControls(e);d._hideToolTips();if(!h)d.play();else d.pause()},_fullscreenOnWindowResize:function(){var g=this,d=b(window).width(),e=b(window).height(),f=d-c.width();c.css({width:d,height:e});a.attr("width",d).attr("height",e);g._positionControls(f)},_positionControls:function(b){var a=c.find(".wijmo-wijvideo-index-slider");a.width(a.width()+b)},_showToolTip:function(e){var c=this,a=e.pageX,f=e.pageY,g=d.offset().left,h=d.width(),i=a-g,j=c._getVideoAttribute("duration"),b;b=j*(i/h);d.wijtooltip("option","content",c._getToolTipContent(b));d.wijtooltip("showAt",{x:a,y:f-10})},_changeToolTipContent:function(i){var b=this,c=i.pageX,e=d.offset().left,f=d.width(),g=c-e,h=b._getVideoAttribute("duration"),a;a=h*(g/f);d.wijtooltip("option","content",b._getToolTipContent(a))},_hideToolTips:function(){d.wijtooltip("hide");e.wijtooltip("hide");g.wijtooltip("hide")},_getToolTipContent:function(c){var a,b,d="",e="";a=parseInt(c/60,10);b=parseInt(c-a*60,10);if(a<10)d="0";if(b<10)e="0";return d+a+":"+e+b},destroy:function(){var d=this;b.Widget.prototype.destroy.apply(this,arguments);c.after(a).remove();a.unbind("."+d.widgetName);d._videoIsControls&&d._setVideoAttribute("controls",true)},play:function(){a[0].play()},pause:function(){a[0].pause()}})})(jQuery);