/*
 *
 * Wijmo Library 2.0.0
 * http://wijmo.com/
 *
 * Copyright(c) ComponentOne, LLC.  All rights reserved.
 * 
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * licensing@wijmo.com
 * http://www.wijmo.com/license
 *
 **/
(function(a){"use strict";var g="@wijtp@",b="wijmo-wijtooltip",e=b+"-arrow-",c=parseFloat,i=window,d=document,j=Math,h=j.max,f={};a.widget("wijmo.wijtooltip",{options:{content:"",title:"",closeBehavior:"auto",mouseTrailing:false,triggers:"hover",position:{my:"left bottom",at:"right top",offset:null},showCallout:true,animation:{animated:"fade",duration:500,easing:null},showAnimation:{},hideAnimation:{},showDelay:150,hideDelay:150,calloutAnimation:{duration:1e3,disabled:false,easing:null},calloutFilled:true,modal:false,group:null,ajaxCallback:null,showing:null,shown:null,hiding:null,hidden:null},_setOption:function(c,f){var b=this,e="_set_"+c,d=b.options[c];a.Widget.prototype._setOption.apply(b,arguments);if(a.isPlainObject(f))b.options[c]=a.extend({},d,f);b[e]&&b[e](d)},_set_content:function(){var a=this;if(a._isAjaxCallback){a._callbacked=true;a.show();a._callbacked=false}else a._setText()},_create:function(){var c=this,i=c.options,e=c.element,h=e&&e.attr("id"),d="",f=i.group||g,b=a.wijmo.wijtooltip._getTooltip(f);if(b)b.count++;else{b=c._createTooltip();b.count=0;a.wijmo.wijtooltip._tooltips[f]=b}i.position.of=c.element;c._bindLiveEvents();c._tooltip=b;if(h!==""){d=b.attr("aria-describedby");d=d===undefined?"":d+" ";b.attr("aria-describedby",d+h)}},destroy:function(){var b=this,c=b.element,d=b.options.group||g;c.unbind(".tooltip");c.attr("title",b._content);a.wijmo.wijtooltip._removeTooltip(d);a.Widget.prototype.destroy.apply(b)},widget:function(){return this._tooltip},show:function(){var b=this,c=b._tooltip,d=b.options;if(!c)return;if(c._hideAnimationTimer){clearTimeout(c._hideAnimationTimer);c._hideAnimationTimer=null}c.stop(true,true);if(d.ajaxCallback&&a.isFunction(d.ajaxCallback)&&!b._callbacked){b._isAjaxCallback=true;d.ajaxCallback.call(b.element);return}c._showAnimationTimer=setTimeout(function(){b._setText();f=c.offset();if(d.mouseTrailing){b._setCalloutCss();return}b._setPosition();b._showTooltip()},b.options.showDelay)},showAt:function(a){var e=this,b=e._tooltip,n=b&&b._callout,m={},k=0,l=0,o={},g,h,c,d,j,i;if(!b||!n)return;b.stop(true,true);b._showAnimataionTimer=setTimeout(function(){e._setText();f=b.offset();b.offset({left:0,top:0}).show();m=n.position();k=m.left;l=m.top;h=e._getBorder(n);c=h.left||h.right;d=h.top||h.bottom;j=b.width();i=b.height();g=e._getCalloutShape();o=({rt:{left:a.x-j-c,top:a.y-l},rc:{left:a.x-j-c,top:a.y-i/2},rb:{left:a.x-j-c,top:a.y-l-d},lt:{left:a.x+c,top:a.y-l},lc:{left:a.x+c,top:a.y-i/2},lb:{left:a.x+c,top:a.y-l-d},tl:{left:a.x-k,top:a.y+d},tc:{left:a.x-j/2,top:a.y+d},tr:{left:a.x-k-c,top:a.y+d},bl:{left:a.x-k,top:a.y-i-d},bc:{left:a.x-j/2,top:a.y-i-d},br:{left:a.x-k-c,top:a.y-i-d}})[g];g=e._flipTooltip(o,g,h);e._setUnfilledCallout(g);b.offset(o).hide();e._calloutShape=g;e._showTooltip()},e.options.showDelay)},hide:function(){var b=this,c=b._tooltip;if(!c)return;clearTimeout(c._showAnimationTimer);c._hideAnimationTimer=setTimeout(a.proxy(b._hideTooltip,b),b.options.hideDelay)},_createTooltip:function(){var j=this,d="ui-corner-all",f="ui-widget-content",k="ui-state-default",l="ui-widget-header",c=a("<div class = '"+b+" ui-widget "+f+" "+d+"'></div>"),g=a("<div class='"+b+"-container'></div>"),h=a("<div class='"+f+" "+b+"-pointer '><div class='"+b+"-pointer-inner'></div></div>"),i=a("<div class = '"+b+"-title "+l+" "+d+"'></title>"),e=a("<a href='#' class = '"+b+"-close "+k+" "+d+"'></a>");e.append(a("<span class = 'ui-icon ui-icon-close'></span>")).bind("click",a.proxy(j._onClickCloseBtn,j));c.append(i).append(e).append(g).append(h).css("position","absolute").attr("role","tooltip").appendTo("body").hide();c._container=g;c._callout=h;c._closeBtn=e;c._title=i;return c},_bindLiveEvents:function(){var b=this,d=b.options,c=b.element;if(b._content===undefined){b._content=c.attr("title");c.attr("title","")}c.unbind(".tooltip");d.mouseTrailing&&c.bind("mousemove.tooltip",function(a){var e=d.position.offset||"",c=e.split(" ");if(c.length===2)b.showAt({x:a.pageX+parseInt(c[0],10),y:a.pageY+parseInt(c[1],10)});else b.showAt({x:a.pageX,y:a.pageY})});switch(d.triggers){case"hover":c.bind("mouseover.tooltip",a.proxy(b.show,b)).bind("mouseout.tooltip",a.proxy(b._hideIfNeeded,b));break;case"click":c.bind("click.tooltip",a.proxy(b.show,b));break;case"focus":c.bind("focus.tooltip",a.proxy(b.show,b)).bind("blur.tooltip",a.proxy(b._hideIfNeeded,b));break;case"rightClick":c.bind("contextmenu.tooltip",function(a){b.show();a.preventDefault()})}},_hideIfNeeded:function(){var b=this,c=b.options,a=c.closeBehavior;if(a==="sticky"||c.modal||a==="none")return;b.hide()},_flipTooltip:function(d,i,e){var h=this,c=h._tooltip,j={width:c.width(),height:c.height()},b=h._flipCallout(d,j,i),a=b&&b.flip,g,f;if(!c||!b||!a.h&&!a.v)return b.calloutShape;g=c.width();f=c.height();if(a.h==="l")d.left-=g+e.right*2+1;else if(a.h==="r")d.left+=g+e.left*2+1;else if(a.v==="t")d.top-=f+e.bottom*2+1;else if(a.v==="b")d.top+=f+e.top*2+1;return b.calloutShape},_flipCallout:function(g,k,b){var h=this,l=h.options,j=h._tooltip,c={h:false,v:false},f=a(i),d=(l.position.collision||"flip").split(" ");if(d.length===1)d[1]=d[0];if(!j||d[0]!=="flip"&&d[1]!=="flip")return{flip:c};if(d[0]==="flip")if(g.left<0||g.left+k.width>f.width()+f.scrollLeft())c.h=true;if(d[0]==="flip")if(g.top<0||g.top+k.height>f.height()+f.scrollTop())c.v=true;if(c.h)if(b.indexOf("l")>-1){b=b.replace(/l/,"r");c.h="l"}else if(b.indexOf("r")>-1){b=b.replace(/r/,"l");c.h="r"}if(c.v)if(b.indexOf("t")>-1){b=b.replace(/t/,"b");c.v="t"}else if(b.indexOf("b")>-1){b=b.replace(/b/,"t");c.v="b"}if(c.h||c.v){h._removeCalloutCss();j.addClass(e+b)}return{flip:c,calloutShape:b}},_set_position:function(b){var a=this,d=a.options,c=d.position;if(d.showCallout){(b.my!==c.my||b.at!==c.at)&&a._setPosition();a._setCalloutOffset(true)}},_set_showCallOut:function(d){var c=this,b=c._tooltip,a=b&&b._callout;if(!b||!a)return;if(d){c._setCalloutCss();a.show()}else a.hide()},_set_closeBehavior:function(){var c=this,b=c._tooltip,a=b&&b._closeBtn;a&&a[c.options.closeBehavior==="sticky"?"show":"hide"]()},_set_triggers:function(){this._bindLiveEvents()},_set_mouseTrailing:function(){this._bindLiveEvents()},_getCalloutShape:function(){var g=this,e=g.options.position,f=function(b){return a.map(b,function(a){return a.substr(0,1)})},c=f(e.my.split(" ")),d=f(e.at.split(" ")),b=[];if(c.length===2)b=c;if(c[0]===d[0])(c[1]==="t"&&d[1]==="b"||c[1]==="b"&&d[1]==="t")&&b.reverse();else d[0]==="c"&&b.reverse();b[0]==="c"&&b.reverse();return b.join("")},_setCalloutCss:function(){var a=this,f=a.options,d=a._tooltip,c="",b="";if(!f.showCallout)return;a._removeCalloutCss();b=a._getCalloutShape();c=e+b;d&&d.addClass(c);return b},_removeCalloutCss:function(){var b=this._tooltip;b&&a.each(["tl","tc","tr","bl","bc","br","rt","rc","rb","lt","lc","lb"],function(d,c){var a=e+c;if(b.hasClass(a)){b.removeClass(a);return false}})},_getBorder:function(d){var b={};a.each(["top","right","left","bottom"],function(e,a){b[a]=c(d.css("border-"+a+"-width"))});return b},_setPosition:function(){var e=this,m=e.options,d=m.position,a=e._tooltip,p=a.is(":hidden"),f=e._setCalloutCss(),n=f?f.split(""):null,b=[0,0],h="",g=a._callout,i,l,r,q,j,s={width:a.width(),height:a.height()},o,k;p&&a.show();a.css({left:0,top:0});if(m.showCallout){i=e._getBorder(g);r=c(g.css("left"));l=c(g.css("top"));q=c(g.css("right"));j=c(g.css("bottom"));switch(n[0]){case"l":b[0]=i.right;break;case"r":b[0]=-i.left;break;case"b":b[1]=j;break;case"t":b[1]=-l}switch(n[1]){case"t":b[1]=-l;break;case"b":b[1]=j;break;case"r":b[0]=q;break;case"l":b[0]=-r}h=b.join(" ")}a.position({my:d.my,at:d.at,of:d.of,offset:h,collision:"none none"});o=e._flipCallout(a.offset(),s,f);k=o.flip;if(k.h||k.v){a.css({left:0,top:0});a.position({my:d.my,at:d.at,of:d.of,offset:h,collision:d.collision})}m.showCallout&&e._setUnfilledCallout(f);e._calloutShape=f;p&&a.hide()},_setCalloutOffset:function(h){var g=this,k=g.options,j=g._tooltip,e=j&&j._callout,l=g._calloutShape,d=false,f=k.position.offset,c="",b=[],i=k.calloutAnimation;if(!e)return;if(!f||f.length===0)return;e.stop(true,true);a.each(["tr","tc","tl","bl","bc","br"],function(b,a){if(l===a){d=true;return false}});if(f){b=f.split(" ");if(b.length===2)c=d?b[0]:b[1];else if(b.length===1)c=b[0]}if(c!=="")if(h&&!h.disabled)e.animate(d?{left:c}:{top:c},i.duration,i.easing);else e.css(d?"left":"top",c)},_setUnfilledCallout:function(g){var e=this,c=e._tooltip,d=c&&c._callout,a=d&&d.children(),f=g.split(""),b=c&&c.css("background-color");if(!a)return;a.css({"border-left-color":"","border-top-color":"","border-bottom-color":"","border-right-color":""});if(e.options.calloutFilled)switch(f[0]){case"l":a.css("border-right-color",b);break;case"t":a.css("border-bottom-color",b);break;case"r":a.css("border-left-color",b);break;case"b":a.css("border-top-color",b)}},_showTooltip:function(){var c=this,d=c.options,b=c._tooltip,e,g,j,h=b&&b._closeBtn,i=b&&b._callout;if(!b)return;if(c._trigger("showing",null,c)===false)return;h&&h[d.closeBehavior==="sticky"?"show":"hide"]();i&&i[d.showCallout?"show":"hide"]();c._showModalLayer();b.css("z-index",99999);if(!d.mouseTrailing&&a.fn.wijshow){g={show:true,context:b};e=a.extend({},d.animation,d.showAnimation);if(b.is(":visible")){j=b.offset();b.offset(f);a.extend(g,{pos:j});e.animated="tooltipSlide"}b.wijshow(e,a.wijmo.wijtooltip.animations,g,null,function(){c._trigger("shown")})}else{b.show();c._trigger("shown")}c._setCalloutOffset(false)},_hideTooltip:function(){var b=this,d=b.options,c=b._tooltip,f=a.extend({},d.animation,d.hideAnimation),e;if(!c)return;if(b._trigger("hiding",null,b)===false)return;b._hideModalLayer();if(!d.mouseTrailing&&a.fn.wijhide){e={show:true,context:c};c.wijhide(f,a.wijmo.wijtooltip.animations,e,null,function(){b._trigger("hidden");c.css("z-index","")})}else{c.hide();b._trigger("hidden");c.css("z-index","")}},_getContent:function(b){var c={data:""},d;if(a.isFunction(b)){d=b.call(this.element,c);return c.data!==""?c.data:d}return b},_setText:function(){var b=this,f=b.options,c=b._tooltip,a="",d="",e=c&&c._title;if(!c)return;a=b._getContent(f.content);a=a===""?b._content:a;c._container.html(a);d=b._getContent(f.title);if(d!=="")e.html(d).show();else e.hide()},_showModalLayer:function(){var b=this,c=null;if(b.options.modal){c=a("<div>").addClass("ui-widget-overlay").css("z-index",99e3).width(b._getDocSize("Width")).height(b._getDocSize("Height")).appendTo("body");b._tooltip._modalLayer=c}},_hideModalLayer:function(){var b=this,a=b._tooltip._modalLayer;a&&a.css("z-index","").remove()},_getDocSize:function(b){var c,e,g="documentElement",f="body";if(a.browser.msie&&a.browser.version<9){c=h(d[g]["scroll"+b],d[f]["scroll"+b]);e=h(d[g]["offset"+b],d[f]["offset"+b]);return c<e?a(i)[b.toLowerCase()]()+"px":c+"px"}else return a(d)[b.toLowerCase()]()+"px"},_onClickCloseBtn:function(a){this.hide();a.preventDefault()}});a.extend(a.wijmo.wijtooltip,{animations:{fade:function(b,c){b=a.extend({duration:300,easing:"swing"},b,c);b.context.stop(true,true).animate(b.show?{opacity:"show"}:{opacity:"hide"},b)},tooltipSlide:function(b,c){b=a.extend({duration:300,easing:"swing"},b,c);b.context.stop(true,true).animate({left:b.pos.left,top:b.pos.top},b)}},_tooltips:{},_getTooltip:function(b){return a.wijmo.wijtooltip._tooltips[b]},_removeTooltip:function(c){var b=a.wijmo.wijtooltip._tooltips[c];if(b){b.count--;b.count<=0&&b.remove();a.wijmo.wijtooltip._tooltips[c]=null}}})})(jQuery);