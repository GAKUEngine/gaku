/*
 *
 * Wijmo Library 2.0.0
 * http://wijmo.com/
 *
 * Copyright(c) ComponentOne, LLC.  All rights reserved.
 * 
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * licensing@wijmo.com
 * http://www.wijmo.com/license
 *
 **/
(function(a){"use strict";var b="wijmo-wijprogressbar",j="ui-progressbar",i=j+"-label",c=b+"-lb-",d="ui-corner-",g=d+"left",f=d+"right",h=d+"top",e=d+"bottom";a.widget("wijmo.wijprogressbar",a.ui.progressbar,{options:{labelAlign:"center",maxValue:100,minValue:0,fillDirection:"east",labelFormatString:"{1}%",toolTipFormatString:"{1}%",indicatorIncrement:1,indicatorImage:"",animationDelay:0,animationOptions:{disabled:false,easing:null,duration:500},progressChanging:null,beforeProgressChanging:null,progressChanged:null},_setOption:function(c,d){var b=this,e=b.options,f;switch(c){case"value":e[c]=parseInt(d,10);b._refreshValue();return;case"maxValue":e.max=d;case"minValue":f=parseInt(d,10);e[c]=f;b[c==="maxValue"?"max":"min"]=f;b._refreshValue(true);return;case"labelFormatString":case"toolTipFormatString":e[c]=d;b._refreshValue(true);return;case"fillDirection":case"labelAlign":case"indicatorImage":e[c]=d;b._updateElementsCss();return}a.Widget.prototype._setOption.apply(b,arguments);c==="disabled"&&b._handleDisabledOption(d,b.element)},_create:function(){var c=this,d=c.options,e=c.element;c.directions={east:"left",west:"right",north:"bottom",south:"top"};c.min=d.minValue;c.max=d.maxValue;e.addClass(b);a.ui.progressbar.prototype._create.apply(c,arguments);c.label=a("<span>").addClass(i).appendTo(e);c._updateElementsCss();c._isInit=true;d.disabled&&c.disable();c._refreshValue()},_handleDisabledOption:function(b,c){var a=this;if(b){if(!a.disabledDiv)a.disabledDiv=a._createDisabledDiv(c);a.disabledDiv.appendTo("body")}else if(a.disabledDiv){a.disabledDiv.remove();a.disabledDiv=null}},_createDisabledDiv:function(d){var g=this,b=d?d:g.element,c=b.offset(),f=b.outerWidth(),e=b.outerHeight();return a("<div></div>").addClass("ui-disabled").css({"z-index":"99999",position:"absolute",width:f,height:e,left:c.left,top:c.top})},_triggerEvent:function(a,c,b){return this._trigger(a,null,{oldValue:c,newValue:b})===false},_refreshValue:function(i){var b=this,g=b.options,f=g.animationOptions,h=b.element,c,e,d;if(!b._isInit)return;d=h.attr("aria-valuenow");c=b.value();e=(c-b.min)/(b.max-b.min)*100;if(b._triggerEvent("beforeProgressChanging",d,c))return;if(!f.disabled&&f.duration>0)setTimeout(function(){a.wijmo.wijprogressbar.animations.progress({content:b.valueDiv,complete:function(){b._triggerEvent("progressChanged",d,c);b._lastStep=e},step:function(a){b._performAnimating(a,i)},progressValue:c*100},f)},g.animationDelay);else{b._refreshProgress(Math.round(e));b._lastStep=e;b._triggerEvent("progressChanged",d,c)}},_refreshProgress:function(d,c){var b=this,i=b.options,j=i.fillDirection,k=b.element;if(c===undefined)c=a.wijmo.wijprogressbar.mul(d,b.max-b.min)/100+b.min;if(b._triggerEvent("progressChanging",k.attr("aria-valuenow"),c))return;if(b._isHorizontal())b.valueDiv.toggleClass(j==="east"?f:g,c===b.max).width(d+"%");else b.valueDiv.toggleClass(j==="south"?e:h,c===b.max).height(d+"%");b.label.html(b._getFormatString(i.labelFormatString,d,c));k.attr("aria-valuenow",c).attr("title",b._getFormatString(i.toolTipFormatString,d,c))},_isHorizontal:function(){var a=this.options.fillDirection;return a==="west"||a==="east"},_getRotateTextOffset:function(a){var c,b;a.css("width","auto");c=a.outerWidth();b=a.outerHeight();a.css("width","");return Math.max(c-b-4,0)},_updateElementsCss:function(){var a=this,e=a.options,d=a.element,c=e.fillDirection;d.removeClass(b+"-west "+b+"-east "+b+"-north "+b+"-south").addClass(b+"-"+c);a._updateProgressCss();a._updateLabelCss()},_updateLabelCss:function(){var d=this,i=d.options,g=d.element,b=i.labelAlign,e=d.label,f=d._lastStep,h=g.height();e.removeClass(c+"west "+c+"east "+c+"south "+c+"north "+c+"center "+c+"running").addClass(c+b).css({left:"",right:"",top:"",bottom:"",width:"","text-align":"","line-height":""});b!=="north"&&b!=="south"&&!(b==="running"&&!d._isHorizontal())&&e.css("line-height",h+"px");if(b==="running")d._updateRunningLabelCss(f);else if(!d._isHorizontal()&&!a.browser.msie)if(b==="north")e.css("width","100%").css("text-align","right");else b==="south"&&e.css("width","100%").css("text-align","left")},_updateRunningLabelCss:function(l){var b=this,m=b.options,i=m.fillDirection,k=b.element,f=b.label,j=b.valueDiv,e=b._isHorizontal(),c,d,g,h;c=k[e?"width":"height"]();d=f[e?"outerWidth":"outerHeight"]();g=j[e?"outerWidth":"outerHeight"]();if(!e&&!a.browser.msie)d+=b._getRotateTextOffset(f);h=c===g?c-d:l*c/100-d+d*(c-g)/c;f.css(b.directions[i],h)},_updateProgressCss:function(){var b=this,j=b.options,k=j.fillDirection,i=j.indicatorImage,a=b.valueDiv,c=b._lastStep;i!==""&&a.css("background","transparent url("+i+") repeat fixed");a.removeClass(g+" "+f+" "+h+" "+e).addClass(d+b.directions[k]);if(c)if(b._isHorizontal())a.css("width",c+"%").css("height","");else a.css("height",c+"%").css("width","");else a.css({width:"",height:""})},_performAnimating:function(l,k){var c=this,j=c.options,d=j.indicatorIncrement,i=l/100,b=a.wijmo.wijprogressbar.div(i-c.min,c.max-c.min)*100,f=0,g,h,e=2;if(d){g=b.toString().split(".");if(g.length===2){f=g[1].length;e=f}h=Math.pow(10,f);if(d!==1)b=Math.floor(b*h/d)*d/h;else{b=Math.round(b);e=0}c.pointNumber=f;if(c._lastStep===b&&!k)return}c._refreshProgress(Number(b.toFixed(e)),Number(i.toFixed(e)));j.labelAlign==="running"&&c._updateRunningLabelCss(b)},_getFormatString:function(a,d,e){var c=this,g=c.max-e,f=100-d,b=/\{0\}/g;a=a.replace(b,e.toString());b=/\{ProgressValue\}/g;a=a.replace(b,e.toString());b=/\{1\}/g;a=a.replace(b,d.toString());b=/\{PercentProgress\}/g;a=a.replace(b,d.toString());b=/\{2\}/g;a=a.replace(b,g.toString());b=/\{RemainingProgress\}/g;a=a.replace(b,g.toString());b=/\{3\}/g;a=a.replace(b,f.toString());b=/\{PercentageRemaining\}/g;a=a.replace(b,f.toString());b=/\{4\}/g;a=a.replace(b,c.min);b=/\{Min\}/g;a=a.replace(b,c.min);b=/\{5\}/g;a=a.replace(b,c.max);b=/\{Max\}/g;a=a.replace(b,c.max);return a},destroy:function(){var c=this,d=c.element;d.attr("title","").removeClass(b+" "+b+"-east "+b+"-west "+b+"-north "+b+"-south");c.label&&c.label.remove();if(c.disabledDiv){c.disabledDiv.remove();c.disabledDiv=null}a.ui.progressbar.prototype.destroy.apply(this,arguments)}});a.extend(a.wijmo.wijprogressbar,{animations:{progress:function(b,c){b=a.extend({easing:"swing",duration:1e3},b,c);b.content.stop(true,true).animate({pgvalue:b.progressValue},b)}},add:function(b,c){var d=0,e=0,a;try{d=b.toString().split(".")[1].length}catch(g){}try{e=c.toString().split(".")[1].length}catch(f){}a=Math.pow(10,Math.max(d,e));return(b*a+c*a)/a},mul:function(d,e){var a=0,b=d.toString(),c=e.toString();try{a+=b.split(".")[1].length}catch(g){}try{a+=c.split(".")[1].length}catch(f){}return Number(b.replace(".",""))*Number(c.replace(".",""))/Math.pow(10,a)},div:function(a,b){var e=0,f=0,c,d;try{e=a.toString().split(".")[1].length}catch(h){}try{f=b.toString().split(".")[1].length}catch(g){}c=Number(a.toString().replace(".",""));d=Number(b.toString().replace(".",""));return c/d*Math.pow(10,f-e)}})})(jQuery);