$('#student_<%= @student_id %> td.total_points').html('<%= @student_total_score %>');
$('#student_<%= @student_id %> td.weighted_scores').html('<%= @student_weights_total %>');

var average, baseDeviation, deviation, i, scoreArray, scores, total_score, total_score_average, total_weights, total_weights_average, weights_arr;

scoreArray = $(".total_points");

total_score = 0;

i = 0;

while (i < scoreArray.length) {
  total_score += parseFloat(scoreArray[i].innerText);
  ++i;
}

total_score_average = total_score / scoreArray.length;

$(".total_points_average").html(Math.floor(total_score_average * 100) / 100);

weights_arr = $(".weighted_scores");

total_weights = 0;

i = 0;

while (i < weights_arr.length) {
  total_weights += parseFloat(weights_arr[i].innerText);
  ++i;
}

total_weights_average = total_weights / weights_arr.length;

$(".weighted_scores_average").html(Math.floor(total_weights_average * 100) / 100);

baseDeviation = 0.0;

if ($("#weighting_total_title").text()) {
  scores = $(".weighted_scores");
  average = total_weights_average;
} else {
  scores = $(".total_points");
  average = total_score_average;
}

i = 0;

while (i < scores.length) {
  baseDeviation += Math.pow(parseFloat($(scores[i]).text()) - average, 2);
  i++;
}

baseDeviation = Math.sqrt(baseDeviation / scores.length);

deviation = 0.0;

i = 0;

while (i < scores.length) {
  deviation = (parseFloat($(scores[i]).text()) - average) / baseDeviation;
  if (isNaN(deviation)) {
    deviation = 50;
  } else {
    deviation = deviation * 10 + 50;
  }
  $(scores[i]).nextAll("#deviation").text(Math.floor(deviation));
  i++;
}
