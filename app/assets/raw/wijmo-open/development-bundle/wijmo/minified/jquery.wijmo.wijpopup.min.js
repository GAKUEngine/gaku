/*
 *
 * Wijmo Library 2.0.0
 * http://wijmo.com/
 *
 * Copyright(c) ComponentOne, LLC.  All rights reserved.
 * 
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * licensing@wijmo.com
 * http://www.wijmo.com/license
 *
 **/
(function(a){"use strict";a.fn.extend({getBounds:function(){return a.extend({},a(this).offset(),{width:a(this).outerWidth(true),height:a(this).outerHeight(true)})},setBounds:function(b){a(this).css({left:b.left,top:b.top}).width(b.width).height(b.height);return this},getMaxZIndex:function(){var b=(a(this).css("z-index")=="auto"?0:a(this).css("z-index"))*1;a(this).siblings().each(function(d,c){b=Math.max(b,(a(c).css("z-index")=="auto"?0:a(c).css("z-index"))*1)});return b}});a.widget("wijmo.wijpopup",{options:{ensureOutermost:false,showEffect:"show",showOptions:{},showDuration:300,hideEffect:"hide",hideOptions:{},hideDuration:100,autoHide:false,position:{at:"left bottom",my:"left top"},showing:null,shown:null,hiding:null,hidden:null,posChanged:null},_create:function(){},_init:function(){if(!!this.options.ensureOutermost){var b=a("form");if(b.length===0)b=a(document.body);this.element.appendTo(b)}this.element.data("visible.wijpopup",false);this.element.css("position","absolute");this.element.position({of:a(document.body)});this.element.hide()},_setOption:function(c){a.Widget.prototype._setOption.apply(this,arguments);if(c==="autoHide"){var b=this.isVisible();this.hide();b&&this.show()}},destroy:function(){a.Widget.prototype.destroy.apply(this,arguments);this.isVisible()&&this.hide();if(a.browser.msie&&a.browser.version<7){jFrame=this.element.data("backframe.wijpopup");!jFrame&&jFrame.remove()}var b=this;this.element.unbind(".wijpopup");a.each(["visible","backframe","animating","width"],function(c,a){b.element.removeData(a+".wijpopup")})},isVisible:function(){return!!this.element.data("visible.wijpopup")&&this.element.is(":visible")},isAnimating:function(){return!!this.element.data("animating.wijpopup")},show:function(d){this._setPosition(d);if(this.isVisible())return;if(this._trigger("showing")===false)return;this.options.autoHide&&a(document).bind("mouseup.wijpopup",a.proxy(this._onDocMouseUp,this));var b=this.options.showEffect||"show",c=this.options.showDuration||300,e=this.options.showOptions||{};this.element.data("animating.wijpopup",true);if(a.effects&&a.effects[b])this.element.show(b,e,c,a.proxy(this._showCompleted,this));else this.element[b](b==="show"?null:c,a.proxy(this._showCompleted,this));(!b||!c||b==="show"||c<=0)&&this._showCompleted()},_showCompleted:function(){this.element.removeData("animating.wijpopup");this.element.data("visible.wijpopup",true);this._trigger("shown")},showAt:function(a,b){this.show({my:"left top",at:"left top",of:document.body,offset:""+a+" "+b})},hide:function(){if(!this.isVisible())return;if(this._trigger("hiding")===false)return;a(document).unbind("mouseup.wijpopup");var b=this.options.hideEffect||"hide",c=this.options.hideDuration||300,d=this.options.hideOptions||{};this.element.data("animating.wijpopup",true);if(a.effects&&a.effects[b])this.element.hide(b,d,c,a.proxy(this._hideCompleted,this));else this.element[b](b==="hide"?null:c,a.proxy(this._hideCompleted,this));(!b||!c||b==="hide"||c<=0)&&this._hideCompleted()},_hideCompleted:function(){if(this.element.data("width.wijpopup")!==undefined){this.element.width(this.element.data("width.wijpopup"));this.element.removeData("width.wijpopup")}this.element.removeData("animating.wijpopup").unbind("move.wijpopup");if(a.browser.msie&&a.browser.version<7){var b=this.element.data("backframe.wijpopup");b&&b.hide()}this._trigger("hidden")},_onDocMouseUp:function(c){var b=a(c.target?c.target:c.srcElement);if(this.isVisible()&&!!this.options.autoHide&&!b.parents().hasClass("wijmo-wijcombobox-list"))b.get(0)!=this.element.get(0)&&b.parents().index(this.element)<0&&this.hide()},_onMove:function(){var a=this.element.data("backframe.wijpopup");if(a){this.element.before(a);a.css({top:this.element.css("top"),left:this.element.css("left")})}},_addBackgroundIFrame:function(){if(a.browser.msie&&a.browser.version<7){var b=this.element.data("backframe.wijpopup");if(!b){b=jQuery("<iframe/>").css({position:"absolute",display:"none",filter:"progid:DXImageTransform.Microsoft.Alpha(style=0,opacity=0)"}).attr({src:"javascript:'<html></html>';",scrolling:"no",frameborder:"0","tabIndex ":-1});this.element.before(b);this.element.data("backframe.wijpopup",b);this.element.bind("move.wijpopup",a.proxy(this._onMove,this))}b.setBounds(this.element.getBounds());b.css({display:"block",left:this.element.css("left"),top:this.element.css("top"),"z-index":this.element.css("z-index")-1})}},_setZIndex:function(b){this.element.css("z-index",b);var a=this.element.data("backframe.wijpopup");a&&a.css("z-index",this.element.css("z-index")-1)},_setPosition:function(c){var d=this.element.is(":visible");this.element.show();this.element.position(a.extend({},this.options.position,c?c:{}));!d&&this.element.hide();this._addBackgroundIFrame();var b=1e3;if(this.options.position.of)b=Math.max(b,a(this.options.position.of).getMaxZIndex());this._setZIndex(b+10);this._trigger("posChanged")}})})(jQuery);